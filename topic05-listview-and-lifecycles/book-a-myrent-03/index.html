 <!DOCTYPE html>
 <html>
   <head>

     <link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>

     <meta charset="utf-8">
     <meta name="viewport" content="width=device-width, initial-scale=1">

     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.1.4/semantic.min.css" type="text/css">
     <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/styles/solarized_light.min.css" rel="stylesheet" />

     <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
     <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery.address/1.6/jquery.address.min.js"></script>
     <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.1.4/semantic.min.js"></script>
     <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/highlight.min.js"></script>
     <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/languages/java.min.js"></script>
     <script>hljs.initHighlightingOnLoad();</script>

      <style>


body 
{
  font-family: "Open Sans", "Helvetica", "Helvetica Neue",  "Arial", sans-serif;
}

figcaption
{
  margin-bottom: 20px;
}

.vertical-align
{
  display: flex;
  align-items: center;
}

.credits
{
  min-height:20px;
}
    </style>

  </head>

  <body>

  <div class="ui container">
<style>


code
{
  font-family: "Monaco";
  font-size: 110%;
}

img
{
  padding:1px;
  border:1px solid black;
}

h1
{
  font-style:italic;
  font-size:130%;
  border-bottom: thin solid black;
}
h2
{
  font-size:110%;
  border-bottom: thin solid black;
}
h3
{
  font-size:100%;
  border-bottom: thin solid black;
}

</style>

<div class="ui fixed top pointing inverted menu labmenu">
  <header class="header item">
    <a href="../index.html">
      <i class="sitemap icon"></i>
      Listview & Lifecycles
    </a>
  </header>
  <div class="right tab-menu menu">
    <a class="active item" data-tab="MyRent-03">
        MyRent-03
    </a>
      <a class="item" data-tab="01">
        01
      </a>
      <a class="item" data-tab="02">
        02
      </a>
      <a class="item" data-tab="03">
        03
      </a>
      <a class="item" data-tab="04">
        04
      </a>
      <a class="item" data-tab="05">
        05
      </a>
      <a class="item" data-tab="06">
        06
      </a>
    </div>
</div>

<br><br>

  <div  class="ui tab segment lab" data-tab="MyRent-03">
    <h1>Action Bar &amp; Dialogs</h1>
<p>In a significant update to the app, we introduce navigation within the app using an Action Bar. This will allow us to create new residences, or navigate to existing ones. Additionally, we will explore a simple date picker dialog to allow the user to select a registration date for the residence.</p>
  </div>
  <div  class="ui tab segment lab" data-tab="01">
    <h1>Overview</h1>
<p>At the end of this session the following features will have been added:</p>
<ul>
<li>
<p>The action bar with menus as shown in Figure 1
<img alt="Figure 1: Action bar and menu" src="img/13.png"></p>
</li>
<li>
<p>Date picker as shown in Figure 2
<img alt="Figure 2: Date picker to facilitate setting registration date" src="img/01.png"></p>
</li>
</ul>
  </div>
  <div  class="ui tab segment lab" data-tab="02">
    <h1>Resources</h1>
<p>Continue building the MyRent app that you commenced in the previous lab.</p>
<p>For reference, we are providing a version here, MyRent-02:</p>
<pre><code>git clone https://github.com/wit-computing/myrent-02.git
</code></pre>

<p>We perform some surgery as follows on the incoming code base to allow the menus we are about to introduce to render correctly. </p>
<ul>
<li>Replace <em>ResidenceActivity extends Activity</em>, changing the base class AppCompatActivity</li>
</ul>
<pre><code>public class ResidenceActivity extends Activity implements TextWatcher, CompoundButton.OnCheckedChangeListener
</code></pre>

<p>Remove the AppCompatActivity import and replace with:</p>
<pre><code>import android.app.Activity;
</code></pre>

<p>Make some changes to build.gradle:</p>
<ul>
<li>Target API 19</li>
<li>Remove the appcompat dependency.</li>
</ul>
<p>The refactored build.gradle is provided at the foot of the page.</p>
<p>In res/menu/myrent.xml replace tools:context=".MyRentActivity" with:</p>
<pre><code>tools:context=&quot;.ResidenceActivity&quot;
</code></pre>

<p>This to match the activity name change we introduced earlier.</p>
<p>We are now ready to proceed to intruduce a new menu.</p>
<ul>
<li>Add these string resources to <em>res/values/strings.xml</em></li>
</ul>
<pre><code>  &lt;string name=&quot;new_residence&quot;&gt;New Residence&lt;/string&gt;
  &lt;string name=&quot;settings&quot;&gt;Settings&lt;/string&gt;
</code></pre>

<p>In the folder <em>res/menu</em> create a new file <em>residencelist.xml</em>.</p>
<p>Here is the file content:</p>
<p>Filename: residencelist.xml</p>
<pre><code>&lt;menu xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
      xmlns:tools=&quot;http://schemas.android.com/tools&quot;
      tools:context=&quot;org.wit.myrent.ResidenceActivity&quot; &gt;

  &lt;item android:id=&quot;@+id/menu_item_new_residence&quot;
        android:icon=&quot;@android:drawable/ic_menu_add&quot;
        android:title=&quot;@string/new_residence&quot;
        android:showAsAction=&quot;ifRoom|withText&quot;/&gt;


  &lt;item
      android:id=&quot;@+id/action_settings&quot;
      android:orderInCategory=&quot;100&quot;
      android:showAsAction=&quot;never&quot;
      android:title=&quot;@string/settings&quot;/&gt;

&lt;/menu&gt;



</code></pre>

<p>Next, we bind this newly-created menu to the activity within which we wish the menu to appear, namely ResidenceListActivity.</p>
<ul>
<li>Add this override to ResidenceListActivity:</li>
</ul>
<pre><code>  @Override
  public boolean onCreateOptionsMenu(Menu menu)
  {
    MenuInflater menuInflater = getMenuInflater();
    menuInflater.inflate(R.menu.residencelist, menu);
    return true;
  }
</code></pre>

<p>These imports are required:</p>
<pre><code>import android.view.Menu;
import android.view.MenuInflater;

</code></pre>

<p>Observe in the above method, <em>onCreateOptionsMenu</em>, how the <em>residencelist</em> menu is accessed.</p>
<p>Figure 1 shows the relationship between the xml and display.</p>
<p><img alt="Figure 1: Action Bar &amp; Menu" src="img/14.png"></p>
<p>Build and run the application. You should see something like that shown in Figure 2.</p>
<p><img alt="Figure 2: Action Bar Menu" src="img/16.png">
Refactored build.gradle</p>
<pre><code>apply plugin: 'com.android.application'

android {
  compileSdkVersion 23
  buildToolsVersion &quot;23&quot;

  defaultConfig {
    applicationId &quot;org.wit.myrent&quot;
    minSdkVersion 16
    targetSdkVersion 19
    versionCode 1
    versionName &quot;1.0&quot;
  }
  buildTypes {
    release {
      minifyEnabled false
      proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
    }
  }
}

dependencies {
  compile fileTree(dir: 'libs', include: ['*.jar'])
}
</code></pre>
  </div>
  <div  class="ui tab segment lab" data-tab="03">
    <h1>Helpers</h1>
<p>Add a new class named <em>IntentHelper</em> to <em>org.wit.android.helpers</em>.</p>
<p>Filename: IntentHelper.java</p>
<pre><code>package org.wit.android.helpers;
import java.io.Serializable;

import android.app.Activity;
import android.content.Intent;

public class IntentHelper
{
  public static void startActivity (Activity parent, Class classname)
  {
    Intent intent = new Intent(parent, classname);
    parent.startActivity(intent);
  }   

  public static void startActivityWithData (Activity parent, Class classname, String extraID, Serializable extraData)
  {
    Intent intent = new Intent(parent, classname);
    intent.putExtra(extraID, extraData);
    parent.startActivity(intent);
  }  

  public static void startActivityWithDataForResult (Activity parent, Class classname, String extraID, Serializable extraData, int idForResult)
  {
    Intent intent = new Intent(parent, classname);
    intent.putExtra(extraID, extraData);
    parent.startActivityForResult(intent, idForResult);
  }
}

</code></pre>
  </div>
  <div  class="ui tab segment lab" data-tab="04">
    <h1>Activities (ResidenceListActivity)</h1>
<p>Here we shall provide the coding to respond to menu selection:</p>
<p>Import the helpers provided in the previous step:</p>
<pre><code>import static org.wit.android.helpers.IntentHelper.startActivityWithData;
import static org.wit.android.helpers.IntentHelper.startActivityWithDataForResult;
</code></pre>

<p>This import statement is necessary:</p>
<pre><code>import android.view.MenuItem;
</code></pre>

<p>Now override <em>onOptionsItemSelected</em> to respond to selecting the menu item to create a new residence instance:</p>
<pre><code>  @Override
  public boolean onOptionsItemSelected(MenuItem item)
  {
    switch (item.getItemId())
    {
      case R.id.menu_item_new_residence: Residence residence = new Residence();
                                         portfolio.addResidence(residence);
                                         startActivityWithDataForResult(this, ResidenceActivity.class, &quot;RESIDENCE_ID&quot;, residence.id, 0);
                                         return true;    

      default:                           return super.onOptionsItemSelected(item);
    }
  } 
</code></pre>

<p>Add this line of code to <em>onItemClick</em></p>
<pre><code>startActivityWithData(this, ResidenceActivity.class, &quot;RESIDENCE_ID&quot;, residence.id);
</code></pre>

<p>Delete remaining lines code: 
<img alt="" src="img/10.png"></p>
<p>Here is refactored method:</p>
<pre><code>  @Override
  public void onItemClick(AdapterView&lt;?&gt; parent, View view, int position, long id)
  {
    Residence residence = adapter.getItem(position);
    startActivityWithData(this, ResidenceActivity.class, &quot;RESIDENCE_ID&quot;, residence.id);
  }
</code></pre>

<p>We no longer use test data. Delete this line from Portfolio:
<img alt="" src="img/11.png"></p>
<p>Delete the now redundant method, also in Portfolio: <em>generateTestData</em></p>
<p><img alt="" src="img/12.png"></p>
<p>One small final change to org.wit.myrent.models.Residence:</p>
<ul>
<li>Add a default value for geoloction in the default constructor:</li>
</ul>
<pre><code>    geolocation = &quot;52.253456,-7.187162&quot;;
</code></pre>

<p>This will ensure the the residence list will always display some meaningful data.</p>
<p>Here is the modified constructor:</p>
<pre><code>  public Residence()
  {
    id = UUID.randomUUID();
    date = new Date();
    geolocation = &quot;52.253456,-7.187162&quot;;
  }
</code></pre>

<p>Check that the app works as expected:</p>
<ul>
<li>Launch the app and select the menu item (+)</li>
<li>Optionally, make some changes to the residence data in the detail view</li>
<li>Switch back to the list view using the back-button.</li>
</ul>
<p>You should be presented with something similar to that shown in Figure 1.</p>
<p><img alt="Figure 1: Using menu to add new residence" src="img/15.png"></p>
  </div>
  <div  class="ui tab segment lab" data-tab="05">
    <h1>Dialog</h1>
<p>The dialog in Figure 1 is an instance of <a href="http://developer.android.com/reference/android/app/DatePickerDialog.html"><strong>DatePickerDialog</strong></a> which is a simple dialog containing a <a href="http://developer.android.com/reference/android/widget/DatePicker.html"><strong>DatePicker</strong></a>.</p>
<ul>
<li>A DatePicker is a widget for selecting a date.</li>
</ul>
<p><img alt="Figure 1: DatePicker widget" src="img/02.png"></p>
<ul>
<li>As shown in Figure 2, the DatePicker is contained in <em>ResidenceActivity</em>.</li>
</ul>
<p><img alt="Figure 2: Object diagram showing DatePickerDialog" src="img/03.png"></p>
  </div>
  <div  class="ui tab segment lab" data-tab="06">
    <h1>Activities (ResidenceActivity)</h1>
<p>We shall now implement the code to allow a user to set the registration date of a residence.</p>
<p>In <em>org.wit.myrent.activities.ResidenceActivity</em> add these import statements:</p>
<pre><code>import java.util.Calendar;
import java.util.Date;
import java.util.GregorianCalendar;

import android.app.DatePickerDialog;
import android.view.View;
import android.view.View.OnClickListener;
</code></pre>

<p>Delete line disabling date button:
<img alt="" src="img/09.png"></p>
<p>Change the signature of ResidenceActivity class by adding </p>
<ul>
<li>View.OnClickListener</li>
<li>DatePickerDialog.OnDateSetListener</li>
</ul>
<p>to the list of implemented interfaces:</p>
<pre><code>public class ResidenceActivity extends Activity implements TextWatcher, OnCheckedChangeListener, View.OnClickListener, DatePickerDialog.OnDateSetListener
{
...
...
}
</code></pre>

<p>This change will trigger errors. Add unimplemented methods manually or using the Android Studio hot keys to autogenerate the methods (as described in detail in previous labs such as in step 9 MyRent-00):</p>
<ul>
<li>public void onDateSet(DatePicker view, int year, int monthOfYear, int dayOfMonth)</li>
<li>public void onClick(View v)</li>
</ul>
<p>Here is the implementation of these methods:</p>
<pre><code>  @Override
  public void onClick(View v)
  {
    switch (v.getId())
    {
      case R.id.registration_date      : Calendar c = Calendar.getInstance();
                                         DatePickerDialog dpd = new DatePickerDialog (this, this, c.get(Calendar.YEAR), c.get(Calendar.MONTH), c.get(Calendar.DAY_OF_MONTH));
                                         dpd.show();
                                         break; 
    }
  }
</code></pre>

<pre><code>  @Override
  public void onDateSet(DatePicker view, int year, int monthOfYear, int dayOfMonth)
  {
    Date date = new GregorianCalendar(year, monthOfYear, dayOfMonth).getTime();
    residence.date = date;
    dateButton.setText(residence.getDateString());
  }
</code></pre>

<p>Set the date button listener in <em>onCreate</em>:</p>
<pre><code>dateButton  .setOnClickListener(this);
</code></pre>

<p>Launch the app and test that this code works as intended:</p>
<ul>
<li>Create a new residence</li>
<li>Change the registration date</li>
<li>Return to the list view and create a further residence.</li>
<li>Return to the list view, click on the first residence, which opens its detail view, and observe that it retains the modified date.</li>
</ul>
<p>For reference, here is the completed ResidenceActivity class:</p>
<pre><code>package org.wit.myrent.activities;

import android.app.Activity;
import android.os.Bundle;
import android.text.Editable;
import android.text.TextWatcher;
import android.util.Log;
import android.view.Menu;
import android.view.MenuItem;
import android.widget.Button;
import android.widget.CheckBox;
import android.widget.CompoundButton;
import android.widget.DatePicker;
import android.widget.EditText;

import org.wit.myrent.R;
import org.wit.myrent.app.MyRentApp;
import org.wit.myrent.models.Portfolio;
import org.wit.myrent.models.Residence;

import java.util.UUID;


import java.util.Calendar;
import java.util.Date;
import java.util.GregorianCalendar;

import android.app.DatePickerDialog;
import android.view.View;
import android.view.View.OnClickListener;
import android.widget.RadioGroup;

public class ResidenceActivity extends Activity implements
    TextWatcher,
    CompoundButton.OnCheckedChangeListener,
    View.OnClickListener,
    DatePickerDialog.OnDateSetListener
{
  private EditText geolocation;
  private Residence residence;

  private CheckBox rented;
  private Button dateButton;

  private Portfolio portfolio;

  @Override
  protected void onCreate(Bundle savedInstanceState)
  {
    super.onCreate(savedInstanceState);
    setContentView(R.layout.activity_residence);

    geolocation = (EditText) findViewById(R.id.geolocation);
    residence = new Residence();

    // Register a TextWatcher in the EditText geolocation object
    geolocation.addTextChangedListener(this);

    dateButton = (Button) findViewById(R.id.registration_date);
    rented = (CheckBox) findViewById(R.id.isrented);

    MyRentApp app = (MyRentApp) getApplication();
    portfolio = app.portfolio;

    UUID resId = (UUID) getIntent().getExtras().getSerializable(&quot;RESIDENCE_ID&quot;);
    residence = portfolio.getResidence(resId);
    if (residence != null)
    {
      updateControls(residence);
    }
  }

  public void updateControls(Residence residence)
  {
    geolocation.setText(residence.geolocation);
    rented.setChecked(residence.rented);
    dateButton.setText(residence.getDateString());
    dateButton.setOnClickListener(this);
  }

  @Override
  public boolean onCreateOptionsMenu(Menu menu)
  {
    // Inflate the menu; this adds items to the action bar if it is present.
    getMenuInflater().inflate(R.menu.myrent, menu);
    return true;
  }

  @Override
  public boolean onOptionsItemSelected(MenuItem item)
  {
    // Handle action bar item clicks here. The action bar will
    // automatically handle clicks on the Home/Up button, so long
    // as you specify a parent activity in AndroidManifest.xml.
    int id = item.getItemId();

    //noinspection SimplifiableIfStatement
    if (id == R.id.action_settings)
    {
      return true;
    }

    return super.onOptionsItemSelected(item);
  }

  @Override
  public void beforeTextChanged(CharSequence charSequence, int i, int i1, int i2)
  {

  }

  @Override
  public void onTextChanged(CharSequence charSequence, int i, int i1, int i2)
  {

  }

  @Override
  public void afterTextChanged(Editable editable)
  {
    residence.setGeolocation(editable.toString());
  }

  @Override
  public void onCheckedChanged(CompoundButton compoundButton, boolean isChecked)
  {
    Log.i(this.getClass().getSimpleName(), &quot;rented Checked&quot;);
    residence.rented = isChecked;
  }

  @Override
  public void onClick(View v)
  {
    switch (v.getId())
    {
      case R.id.registration_date:
        Calendar c = Calendar.getInstance();
        DatePickerDialog dpd = new DatePickerDialog(this, this, c.get(Calendar.YEAR), c.get(Calendar.MONTH), c.get(Calendar.DAY_OF_MONTH));
        dpd.show();
        break;
    }
  }

  @Override
  public void onDateSet(DatePicker view, int year, int monthOfYear, int dayOfMonth)
  {
    Date date = new GregorianCalendar(year, monthOfYear, dayOfMonth).getTime();
    residence.date = date;
    dateButton.setText(residence.getDateString());
  }
}

</code></pre>
  </div>
<script>
$('.ui.menu .item')
  .tab({
    history: true,
    historyType: 'hash'
  })
;
</script>
   </div>



  <br><br>
  <div class="ui bottom fixed borderless menu">
    <div class="ui small item">
    <p id="footertext">
    Prepared by  Eamonn de Leastar (edeleastar@tssg.wit.ie) & John Fitzgerald (johnjfitzgerald@outlook.com). Except where otherwise noted, this content is licensed under a
     <a  href="http://creativecommons.org/licenses/by-nc/4.0/" title="External link to http://creativecommons.org/licenses/by-nc/4.0/"
       target="_blank">Creative Commons Attribution-NonCommercial 4.0 License
     </a>
     </p>
    </div>
  </div>    <script>

$(document).ready(function()
{
  $("img").addClass ("ui image");

  var images = $(".lab img");
  jQuery.each(images, function(i)  {
    if((images[i].alt).length > 0)
    {
      var div_img = $(document.createElement("div")).addClass("ui segment");
      $(images[i]).wrap(div_img);
      var div_label = $(document.createElement("div")).addClass("ui ribbon teal top attached label");
      div_label.append(images[i].alt);
      $(div_label).insertBefore(images[i]);
    }
  });
})    </script>

  </body>
 </html>