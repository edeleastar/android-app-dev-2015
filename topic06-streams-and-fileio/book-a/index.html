 <!DOCTYPE html>
 <html>
   <head>

     <link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>

     <meta charset="utf-8">
     <meta name="viewport" content="width=device-width, initial-scale=1">

     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.1.4/semantic.min.css" type="text/css">
     <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.2/styles/solarized_light.min.css" rel="stylesheet" />

     <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
     <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery.address/1.6/jquery.address.min.js"></script>
     <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.1.4/semantic.min.js"></script>
     <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.2/highlight.min.js"></script>
     <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.2/languages/java.min.js"></script>
     <script>hljs.initHighlightingOnLoad();</script>

      <style>


body 
{
  font-family: "Open Sans", "Helvetica", "Helvetica Neue",  "Arial", sans-serif;
}

figcaption
{
  margin-bottom: 20px;
}

.vertical-align
{
  display: flex;
  align-items: center;
}

.credits
{
  min-height:20px;
}
    </style>

  </head>

  <body>

  <div class="ui container">
<style>


code
{
  font-family: "Monaco";
  font-size: 110%;
}

img
{
  padding:1px;
  border:1px solid black;
}

h1
{
  font-style:italic;
  font-size:130%;
  border-bottom: thin solid black;
}
h2
{
  font-size:110%;
  border-bottom: thin solid black;
}
h3
{
  font-size:100%;
  border-bottom: thin solid black;
}

</style>

<div class="ui fixed top pointing inverted menu labmenu">
  <header class="header item">
    <a href="../index.html">
      <i class="sitemap icon"></i>
      6: Streams & File IO
    </a>
  </header>
  <div class="right tab-menu menu">
    <a class="active item" data-tab="MyRent-06">
        MyRent-06
    </a>
      <a class="item" data-tab="01">
        01
      </a>
      <a class="item" data-tab="02">
        02
      </a>
      <a class="item" data-tab="03">
        03
      </a>
      <a class="item" data-tab="04">
        04
      </a>
      <a class="item" data-tab="05">
        05
      </a>
      <a class="item" data-tab="06">
        06
      </a>
      <a class="item" data-tab="07">
        07
      </a>
      <a class="item" data-tab="08">
        08
      </a>
    </div>
</div>

<br><br>

  <div  class="ui tab segment lab" data-tab="MyRent-06">
    <h1>Fragments &amp; Maps</h1>
<p>Modern Android Activities tend to be composed of one or more Fragments - as opposed to consisting of a single layouts. This introduces a slightly more complicated creation process. However, using fragments opens up other opportunities we will explore in later labs.</p>
  </div>
  <div  class="ui tab segment lab" data-tab="01">
    <h1>Preview</h1>
<p>This lab comprises the following:</p>
<ul>
<li>
<p>Refactoring MyRent: introduction of fragments (Figure 1)</p>
<ul>
<li>Fragments will be necessary later in the course - but not in this lab.
  <img alt="Figure 1: Using fragments" src="img/05.png"></li>
</ul>
</li>
<li>
<p>Launching a map application from within MyRent</p>
<ul>
<li>This will facilitate identifying each residence's geolocation (Figure 2)</li>
</ul>
</li>
</ul>
<p><img alt="Figure 2: Using external Maps application to identify residence's geolocation" src="img/06.png"></p>
  </div>
  <div  class="ui tab segment lab" data-tab="02">
    <h1>ResidenceActivity</h1>
<p>Continue building the MyRent app that you developed in the previous lab.</p>
<p>For reference, we are providing a version here of the completed MyRent-05:</p>
<pre><code>git clone https://github.com/wit-computing/myrent-05.git
</code></pre>

<p>Much of the content of ResidenceActivity inherited from the previous version is being moved to its associated new fragment class, ResidenceFragment.</p>
<p>We now begin refactoring:</p>
<ul>
<li>Replace the contents of <em>ResidenceActivity</em> with the following:</li>
</ul>
<pre><code>package org.wit.myrent.activities;


import org.wit.myrent.R;

import android.os.Bundle;
import android.support.v4.app.Fragment;
import android.support.v4.app.FragmentActivity;
import android.support.v4.app.FragmentManager;

public class ResidenceActivity extends FragmentActivity
{
  public void onCreate(Bundle savedInstanceState)
  {
    super.onCreate(savedInstanceState);
    setContentView(R.layout.fragment_container);

    FragmentManager manager = getSupportFragmentManager();
    Fragment fragment = manager.findFragmentById(R.id.fragmentContainer);
    if (fragment == null)
    {
      fragment = new ResidenceFragment();
      manager.beginTransaction().add(R.id.fragmentContainer, fragment).commit();
    }
  }
}
</code></pre>

<p>Add a container for the associated fragment:</p>
<p>Filename: res/layout/fragment_container.xml</p>
<pre><code>&lt;FrameLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
  android:id=&quot;@+id/fragmentContainerContainer&quot;
  android:layout_width=&quot;match_parent&quot;
  android:layout_height=&quot;match_parent&quot;
  /&gt;
</code></pre>
  </div>
  <div  class="ui tab segment lab" data-tab="03">
    <h1>ResidenceFragment</h1>
<p>Here is the new ResidenceFragment class which comprises, mostly, code migrated from ResidencyActivity in the previous version of MyRent:</p>
<pre><code>package org.wit.myrent.activities;

import java.util.Calendar;
import java.util.Date;
import java.util.GregorianCalendar;
import java.util.UUID;
import org.wit.android.helpers.ContactHelper;
import org.wit.android.helpers.IntentHelper;
import org.wit.myrent.R;
import org.wit.myrent.app.MyRentApp;
import org.wit.myrent.models.Portfolio;
import org.wit.myrent.models.Residence;
import android.app.Activity;
import android.content.Intent;
import android.os.Bundle;
import android.provider.ContactsContract;
import android.support.v4.app.Fragment;
import android.text.Editable;
import android.text.TextWatcher;
import android.util.Log;
import android.view.LayoutInflater;
import android.view.MenuItem;
import android.view.View;
import android.view.View.OnClickListener;
import android.app.DatePickerDialog;
import android.view.ViewGroup;
import android.widget.Button;
import android.widget.CheckBox;
import android.widget.CompoundButton;
import android.widget.CompoundButton.OnCheckedChangeListener;
import android.widget.DatePicker;
import android.widget.EditText;
import static org.wit.android.helpers.IntentHelper.sendEmail;
import static org.wit.android.helpers.IntentHelper.navigateUp;


public class ResidenceFragment extends Fragment implements TextWatcher, 
                                                        OnCheckedChangeListener, 
                                                        OnClickListener, 
                                                        DatePickerDialog.OnDateSetListener
{
  public static   final String  EXTRA_RESIDENCE_ID = &quot;myrent.RESIDENCE_ID&quot;;

  private static  final int     REQUEST_CONTACT = 1;

  private EditText geolocation;
  private CheckBox rented;
  private Button   dateButton;
  private Button   tenantButton;
  private Button   reportButton;

  private Residence   residence;
  private Portfolio   portfolio;

  @Override
  public void onCreate(Bundle savedInstanceState)
  {
    super.onCreate(savedInstanceState);
    setHasOptionsMenu(true);

    UUID resId = (UUID)getActivity().getIntent().getSerializableExtra(EXTRA_RESIDENCE_ID);

    MyRentApp app = (MyRentApp) getActivity().getApplication();
    portfolio = app.portfolio; 
    residence = portfolio.getResidence(resId);  

  }

  @Override
  public View onCreateView(LayoutInflater inflater, ViewGroup parent, Bundle savedInstanceState)
  {
    super.onCreateView(inflater,  parent, savedInstanceState);
    View v = inflater.inflate(R.layout.fragment_residence, parent, false);

    getActivity().getActionBar().setDisplayHomeAsUpEnabled(true);
    addListeners(v);
    updateControls(residence);

    return v;
  } 

  private void addListeners(View v)
  {
    geolocation = (EditText) v.findViewById(R.id.geolocation);
    dateButton  = (Button)   v.findViewById(R.id.registration_date);
    rented      = (CheckBox) v.findViewById(R.id.isrented);
    tenantButton = (Button)  v.findViewById(R.id.tenant);
    reportButton = (Button)  v.findViewById(R.id.residence_reportButton);


    geolocation .addTextChangedListener(this);
    dateButton  .setOnClickListener(this);
    rented      .setOnCheckedChangeListener(this);
    tenantButton.setOnClickListener(this);
    reportButton.setOnClickListener(this);

  }

  public void updateControls(Residence residence)
  {
    geolocation.setText(residence.geolocation);   
    rented.setChecked(residence.rented);
    dateButton.setText(residence.getDateString());
  }

  @Override
  public boolean onOptionsItemSelected(MenuItem item)
  {
    switch (item.getItemId())
    {
    case android.R.id.home: navigateUp(getActivity());
                            return true;
    default:                return super.onOptionsItemSelected(item);
    }
  }

  @Override
  public void onPause()
  {
    super.onPause();
    portfolio.saveResidences();
  }

  @Override
  public void onActivityResult(int requestCode, int resultCode, Intent data)
  {
    if (resultCode != Activity.RESULT_OK)
    {
      return;
    }
    else
      if (requestCode == REQUEST_CONTACT)
      {
        String name = ContactHelper.getContact(getActivity(), data);
        residence.tenant = name;
        tenantButton.setText(name);
      }   
  }

  @Override
  public void beforeTextChanged(CharSequence s, int start, int count, int after)
  { }

  @Override
  public void onTextChanged(CharSequence s, int start, int before, int count)
  {}

  @Override
  public void afterTextChanged(Editable c)
  {
    Log.i(this.getClass().getSimpleName(), &quot;geolocation &quot; + c.toString());
    residence.geolocation = c.toString();    
  }

  @Override
  public void onCheckedChanged(CompoundButton buttonView, boolean isChecked)
  {
    residence.rented = isChecked;   
  }

  @Override
  public void onClick(View v)
  {
    switch (v.getId())
    {
      case R.id.registration_date      : Calendar c = Calendar.getInstance();
                                         DatePickerDialog dpd = new DatePickerDialog (getActivity(), this, c.get(Calendar.YEAR), c.get(Calendar.MONTH), c.get(Calendar.DAY_OF_MONTH));
                                         dpd.show();
                                         break; 
      case R.id.tenant                 : Intent i = new Intent(Intent.ACTION_PICK, ContactsContract.Contacts.CONTENT_URI);
                                         startActivityForResult(i, REQUEST_CONTACT);
                                         if (residence.tenant != null)
                                         {
                                           tenantButton.setText(&quot;Tenant: &quot;+residence.tenant);
                                         }   
                                         break;
      case R.id.residence_reportButton : sendEmail(getActivity(), &quot;&quot;, getString(R.string.residence_report_subject), residence.getResidenceReport(getActivity()));                           
                                         break;                      

    }
  }

  @Override
  public void onDateSet(DatePicker view, int year, int monthOfYear, int dayOfMonth)
  {
    Date date = new GregorianCalendar(year, monthOfYear, dayOfMonth).getTime();
    residence.date = date;
    dateButton.setText(residence.getDateString());
  }
}
</code></pre>

<p>Rename res/layout/activity_residence.xml to the more appropriate name: fragment_residence.xml. </p>
  </div>
  <div  class="ui tab segment lab" data-tab="04">
    <h1>ResidenceListActivity</h1>
<p>As is the case with ResidenceActivity, much of ResidenceListActivity's code is also moved to its new associated fragment class - ResidenceListFragment.</p>
<p>Here is the refactored ResidenceListActivity:</p>
<pre><code>package org.wit.myrent.activities;

import org.wit.myrent.R;

import android.os.Bundle;
import android.support.v4.app.Fragment;
import android.support.v4.app.FragmentActivity;
import android.support.v4.app.FragmentManager;


public class ResidenceListActivity extends FragmentActivity
{

  public void onCreate(Bundle savedInstanceState)
  {
    super.onCreate(savedInstanceState);
    setContentView(R.layout.fragment_container);

    FragmentManager manager = getSupportFragmentManager();
    Fragment fragment = manager.findFragmentById(R.id.fragmentContainer);
    if (fragment == null)
    {
      fragment = new ResidenceListFragment();
      manager.beginTransaction().add(R.id.fragmentContainer, fragment).commit();
    }
  }
}
</code></pre>

<p>As with the ResidenceActivity, a container is required:</p>
<pre><code>&lt;FrameLayout android:id=&quot;@+id/fragmentResidenceListContainer&quot;
             xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
             android:layout_width=&quot;match_parent&quot;
             android:layout_height=&quot;match_parent&quot;/&gt;
</code></pre>
  </div>
  <div  class="ui tab segment lab" data-tab="05">
    <h1>ResidenceListFragment</h1>
<p>Here is the ResidenceListFragment class which comprises, mostly, code migrated from ResidencyListActivity in the previous version of MyRent:</p>
<pre><code>package org.wit.myrent.activities;

import java.util.ArrayList;
import org.wit.android.helpers.IntentHelper;
import org.wit.myrent.R;
import org.wit.myrent.app.MyRentApp;
import org.wit.myrent.models.Portfolio;
import org.wit.myrent.models.Residence;
import android.widget.ListView;
import android.view.LayoutInflater;
import android.view.Menu;
import android.view.MenuInflater;
import android.view.MenuItem;
import android.view.View;
import android.widget.ArrayAdapter;
import android.view.ViewGroup;
import android.widget.AdapterView;
import android.widget.TextView;
import android.widget.CheckBox;
import android.annotation.SuppressLint;
import android.content.Context;
import android.content.Intent;
import android.os.Bundle;
import android.support.v4.app.ListFragment;
import android.widget.AdapterView.OnItemClickListener;

public class ResidenceListFragment extends ListFragment implements OnItemClickListener
{
  private ArrayList&lt;Residence&gt; residences;
  private Portfolio portfolio;
  private ResidenceAdapter adapter;

  @Override
  public void onCreate(Bundle savedInstanceState)
  {
    super.onCreate(savedInstanceState);
    setHasOptionsMenu(true);
    getActivity().setTitle(R.string.app_name);

    MyRentApp app = (MyRentApp) getActivity().getApplication();
    portfolio = app.portfolio;
    residences = portfolio.residences;

    adapter = new ResidenceAdapter(getActivity(), residences);
    setListAdapter(adapter);

  }

  @Override
  public View onCreateView(LayoutInflater inflater, ViewGroup parent, Bundle savedInstanceState)
  {
    View v = super.onCreateView(inflater, parent, savedInstanceState);
    return v;
  }

  @Override
  public void onListItemClick(ListView l, View v, int position, long id)
  {
    Residence res = ((ResidenceAdapter) getListAdapter()).getItem(position);
    Intent i = new Intent(getActivity(), ResidenceActivity.class);
    i.putExtra(ResidenceFragment.EXTRA_RESIDENCE_ID, res.id);
    startActivityForResult(i,0);
  }

  @Override
  public void onResume()
  {
    super.onResume();
    ((ResidenceAdapter) getListAdapter()).notifyDataSetChanged();
  }

  @Override
  public void onCreateOptionsMenu(Menu menu, MenuInflater inflater)
  {
    super.onCreateOptionsMenu(menu, inflater);
    inflater.inflate(R.menu.residencelist, menu);
  }

  @Override
  public boolean onOptionsItemSelected(MenuItem item)
  {
    switch (item.getItemId())
    {
    case R.id.menu_item_new_residence:
      Residence residence = new Residence();
      portfolio.addResidence(residence);

      Intent i = new Intent(getActivity(), ResidenceActivity.class);
      i.putExtra(ResidenceFragment.EXTRA_RESIDENCE_ID, residence.id);
      startActivityForResult(i, 0);
      return true;

    default:
      return super.onOptionsItemSelected(item);
    }
  }

  @Override
  public void onItemClick(AdapterView&lt;?&gt; parent, View view, int position, long id)
  {
    Residence residence = adapter.getItem(position);
    IntentHelper.startActivityWithData(getActivity(), ResidenceActivity.class, &quot;RESIDENCE_ID&quot;, residence.id);
  }

  class ResidenceAdapter extends ArrayAdapter&lt;Residence&gt;
  {
    private Context context;

    public ResidenceAdapter(Context context, ArrayList&lt;Residence&gt; residences)
    {
      super(context, 0, residences);
      this.context = context;
    }

    @SuppressLint(&quot;InflateParams&quot;)
    @Override
    public View getView(int position, View convertView, ViewGroup parent)
    {
      LayoutInflater inflater = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE);
      if (convertView == null)
      {
        convertView = inflater.inflate(R.layout.list_item_residence, null);
      }
      Residence res = getItem(position);

      TextView geolocation = (TextView) convertView.findViewById(R.id.residence_list_item_geolocation);
      geolocation.setText(res.geolocation);

      TextView dateTextView = (TextView) convertView.findViewById(R.id.residence_list_item_dateTextView);
      dateTextView.setText(res.getDateString());

      CheckBox rentedCheckBox = (CheckBox) convertView.findViewById(R.id.residence_list_item_isrented);
      rentedCheckBox.setChecked(res.rented);

      return convertView;
    }
  }
}
</code></pre>

<p>Build and install the app on a device and verify that it functions correctly.</p>
<p>Next we shall engage an external maps application.</p>
  </div>
  <div  class="ui tab segment lab" data-tab="06">
    <h1>Resources (Layout &amp; Strings)</h1>
<ul>
<li>Add a string resource for the Map button to <em>values/strings.xml</em></li>
</ul>
<pre><code>  &lt;string name=&quot;show_map&quot;&gt;Show Map&lt;/string&gt;  
  &lt;string name=&quot;geolocation&quot;&gt;Geolocation&lt;/string&gt;
</code></pre>

<ul>
<li>
<p>You will already have renamed activity_residence.xml as fragment_residence.xml.</p>
</li>
<li>
<p>The following additions are required to the layout:</p>
<ul>
<li>A map button</li>
<li>A geolocation label</li>
</ul>
</li>
</ul>
<p>Here is the modified layout:</p>
<p>Filename: res/layout/fragment_residence.xml</p>
<pre><code>&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;match_parent&quot;
    android:orientation=&quot;vertical&quot; &gt;

  &lt;!-- LOCATION --&gt;
  &lt;TextView
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;wrap_content&quot;
    android:text=&quot;@string/location&quot;
    style=&quot;?android:listSeparatorTextViewStyle&quot;/&gt; 
  &lt;LinearLayout
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;wrap_content&quot;
    android:orientation=&quot;horizontal&quot; 
    android:baselineAligned=&quot;false&quot;&gt;

    &lt;!-- Geolocation (GPS Coords) --&gt;      
    &lt;LinearLayout
      android:layout_width=&quot;0dp&quot;
      android:layout_height=&quot;match_parent&quot;
      android:layout_weight=&quot;60&quot;
      android:orientation=&quot;vertical&quot; &gt;

      &lt;TextView
        android:layout_width=&quot;wrap_content&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:layout_marginLeft=&quot;10dp&quot;
        android:text=&quot;@string/geolocation&quot; /&gt;

      &lt;EditText   
        android:id=&quot;@+id/geolocation&quot;
        android:layout_width=&quot;wrap_content&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:hint=&quot;@string/geolocation_hint&quot; &gt;
       &lt;requestFocus /&gt;   
      &lt;/EditText&gt; 
    &lt;/LinearLayout&gt; 
    &lt;!-- Show Map Button --&gt;          
    &lt;LinearLayout
      android:layout_width=&quot;0dp&quot;
      android:layout_height=&quot;match_parent&quot;
      android:layout_weight=&quot;40&quot;
      android:orientation=&quot;vertical&quot; &gt;

    &lt;Button android:id=&quot;@+id/show_map&quot;
      android:layout_width=&quot;wrap_content&quot;
      android:layout_height=&quot;wrap_content&quot;
      android:text=&quot;@string/show_map&quot;
      android:layout_marginTop=&quot;16dp&quot;
      android:layout_marginLeft=&quot;16dp&quot;
      android:layout_marginRight=&quot;16dp&quot;/&gt;  
  &lt;/LinearLayout&gt;
  &lt;/LinearLayout&gt;

  &lt;!-- STATUS --&gt;   
  &lt;TextView
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;wrap_content&quot;
    android:text=&quot;@string/status&quot;
    style=&quot;?android:listSeparatorTextViewStyle&quot;/&gt;

  &lt;Button android:id=&quot;@+id/registration_date&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;wrap_content&quot;
    android:layout_marginLeft=&quot;16dp&quot;
    android:layout_marginRight=&quot;16dp&quot;/&gt;

  &lt;CheckBox
    android:id=&quot;@+id/isrented&quot;
    android:layout_width=&quot;wrap_content&quot;
    android:layout_height=&quot;wrap_content&quot;
    android:enabled=&quot;true&quot;
    android:focusable=&quot;false&quot;
    android:gravity=&quot;center&quot;
    android:text=&quot;@string/isrented&quot;/&gt;
  &lt;Button
    android:id=&quot;@+id/tenant&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;wrap_content&quot;
    android:layout_marginLeft=&quot;16dp&quot;
    android:layout_marginRight=&quot;16dp&quot;
    android:text=&quot;@string/landlord&quot; /&gt;  

  &lt;Button android:id=&quot;@+id/residence_reportButton&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;wrap_content&quot;
    android:layout_marginLeft=&quot;16dp&quot;
    android:layout_marginRight=&quot;16dp&quot;
    android:text=&quot;@string/residence_report&quot;/&gt; 
&lt;/LinearLayout&gt;
</code></pre>

<p>The changes are evident in the following Figure 1.</p>
<ul>
<li>Note that the registration date is not displayed: the reason for this is that the contents of Figure 1 are formed from screenshots of the Graphical Layout which does not display dynamically generated data (such as the registration dates).</li>
</ul>
<p><img alt="Figure 1: Layout before and following refactoring" src="img/04.png"></p>
  </div>
  <div  class="ui tab segment lab" data-tab="07">
    <h1>Map</h1>
<p>Add the following method to IntentHelper:</p>
<pre><code>  public static void openPreferredLocationInMap(Activity parent, String location)
  {
    Uri geoLocation = Uri.parse(&quot;geo:0,0?&quot;).buildUpon().appendQueryParameter(&quot;q&quot;, location).build();

    Intent intent = new Intent(Intent.ACTION_VIEW);
    intent.setData(geoLocation);

    if (intent.resolveActivity(parent.getPackageManager()) != null)
    {
      parent.startActivity(intent);
    }
    else
    {
      LogHelpers.info(parent, &quot;Couldn't call &quot; + location + &quot;, no receiving apps installed!&quot;);
    }
  } 
</code></pre>

<p>In the above code you will notice that we are using an implicit Intent. </p>
<ul>
<li>This searches for components that are registered for the action we have specified, namely ACTION_VIEW.</li>
<li>Because of the particular argument we have used in the <em>Uri.parse</em> method, the component sought will be one which can display a geolocation. In our case this will be the external maps app that we should already have downloaded onto the emulator or physical device if not already present. See <a href="https://developer.android.com/guide/components/intents-common.html">here</a> for official documentation.</li>
</ul>
<p>Invoke this helper method from within ResidenceFragment by pressing the <em>mapButton</em>.</p>
<p>Here is the wiring to facilitate this. It should be added to ResidenceFragment:</p>
<p>Declare the map button:</p>
<pre><code>  private Button   mapButton;

</code></pre>

<p>Add a map button listener:</p>
<pre><code>   mapButton    = (Button)  v.findViewById(R.id.show_map);

</code></pre>

<p>Register the map button listener:</p>
<pre><code>    mapButton   .setOnClickListener(this);

</code></pre>

<p>Add a handler in the existing <em>onClick(...)</em> method:</p>
<pre><code>      case R.id.show_map               : IntentHelper.openPreferredLocationInMap(getActivity(), residence.geolocation);
                                         break;   

</code></pre>

<p>The following import statement will be necessary:</p>
<pre><code>import org.wit.android.helpers.IntentHelper;
</code></pre>
  </div>
  <div  class="ui tab segment lab" data-tab="08">
    <h1>Test</h1>
<p>Build and install the app on a phsical device or emulator:</p>
<ul>
<li>Create a new residence</li>
<li>Exercise the functionality including checking that pressing the Map button results in a map being launched with a marker positioned at the geolocation entered in residence detailed view.</li>
<li>No difference in the behaviour of the app will be obvious as a consequence of introducing fragments.<ul>
<li>The need for and use of fragments will be demonstrated later in the course.</li>
</ul>
</li>
</ul>
<p><img alt="Figure 1: Test map functionality" src="img/03.png"></p>
  </div>
<script>
$('.ui.menu .item')
  .tab({
    history: true,
    historyType: 'hash'
  })
;
</script>
   </div>



  <br><br>
  <div class="ui bottom fixed borderless menu">
    <div class="ui small item">
    <p id="footertext">
    Prepared by  Eamonn de Leastar (edeleastar@tssg.wit.ie) & John Fitzgerald (johnjfitzgerald@outlook.com). Except where otherwise noted, this content is licensed under a
     <a  href="http://creativecommons.org/licenses/by-nc/4.0/" title="External link to http://creativecommons.org/licenses/by-nc/4.0/"
       target="_blank">Creative Commons Attribution-NonCommercial 4.0 License
     </a>
     </p>
    </div>
  </div>    <script>

$(document).ready(function()
{
  $("img").addClass ("ui image");

  var images = $(".lab img");
  jQuery.each(images, function(i)  {
    if((images[i].alt).length > 0)
    {
      var div_img = $(document.createElement("div")).addClass("ui segment");
      $(images[i]).wrap(div_img);
      var div_label = $(document.createElement("div")).addClass("ui ribbon teal top attached label");
      div_label.append(images[i].alt);
      $(div_label).insertBefore(images[i]);
    }
  });
})    </script>

  </body>
 </html>