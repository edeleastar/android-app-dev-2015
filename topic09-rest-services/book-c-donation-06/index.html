 <!DOCTYPE html>
 <html>
   <head>

     <link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>

     <meta charset="utf-8">
     <meta name="viewport" content="width=device-width, initial-scale=1">

     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.4/semantic.min.css" type="text/css">
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/styles/solarized_light.min.css" rel="stylesheet" />

     <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
     <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery.address/1.6/jquery.address.min.js"></script>
     <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.4/semantic.min.js"></script>
     <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/highlight.min.js"></script>
     <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/languages/java.min.js"></script>
     <script>hljs.initHighlightingOnLoad();</script>

      <style>
        

body 
{
  font-family: "Open Sans", "Helvetica", "Helvetica Neue",  "Arial", sans-serif;
}

figcaption
{
  margin-bottom: 20px;
}

.vertical-align
{
  display: flex;
  align-items: center;
}



    </style>

  </head>

  <body>
    

<style>
  

code
{
  font-family: "Monaco";
  font-size: 110%;
}

img
{
  padding:1px;
  border:1px solid black;
}

h1
{
  font-style:italic;
  font-size:130%;
  border-bottom: thin solid black;
}
h2
{
  font-size:110%;
  border-bottom: thin solid black;
}
h3
{
  font-size:100%;
  border-bottom: thin solid black;
}



</style>

<div class="ui fixed top pointing inverted menu labmenu">
  <header class="header item">
    <i id="toc" class="sitemap icon"></i>
    <a href="../index.html">
      9: APIs & Rest
    </a>
  </header>
  <div class="right tab-menu menu">
    
    <a class="item" data-tab="Donation-06">
      Donation-06
    </a>
    
    <a class="item" data-tab="01">
      01
    </a>
    
    <a class="item" data-tab="02">
      02
    </a>
    
    <a class="item" data-tab="03">
      03
    </a>
    
    <a class="item" data-tab="04">
      04
    </a>
    
    <a class="item" data-tab="05">
      05
    </a>
    
    <a class="item" data-tab="Exercises">
      Exercises
    </a>
    
    <a class="item" href="../../index.html">
      <i class="home icon"></i>
    </a>
  </div>
</div>

<div class="ui segment pushable">
  <div class="ui inverted labeled icon left inline vertical sidebar menu">
    
      
        <a class="item" href="../../topic01-overview-and-tools/book-a-android-tools-01/index.html">
          Android-Tools-01
        </a>
      
    
      
        <a class="item" href="../../topic01-overview-and-tools/book-b-donation-01/index.html">
          Donation-01
        </a>
      
    
      
        <a class="item" href="../../topic01-overview-and-tools/book-c-android-tools-02/index.html">
          Android-Tools-02
        </a>
      
    
      
        <a class="item" href="../../topic02-activities-and-layouts/book-a-donation-02/index.html">
          Donation-02
        </a>
      
    
      
        <a class="item" href="../../topic03-navigation-and-app-structure/book-a-donation-03/index.html">
          Donation-03
        </a>
      
    
      
        <a class="item" href="../../topic03-navigation-and-app-structure/book-b-myrent-00/index.html">
          MyRent-00
        </a>
      
    
      
        <a class="item" href="../../topic03-navigation-and-app-structure/book-c-myrent-01/index.html">
          MyRent-01
        </a>
      
    
      
        <a class="item" href="../../topic04-widgets-and-events/book-a-myrent-02/index.html">
          MyRent-02
        </a>
      
    
      
        <a class="item" href="../../topic04-widgets-and-events/book-b-event-handling/index.html">
          Event-Handling
        </a>
      
    
      
        <a class="item" href="../../topic05-listview-and-lifecycles/book-a-myrent-03/index.html">
          MyRent-03
        </a>
      
    
      
        <a class="item" href="../../topic05-listview-and-lifecycles/book-b-myrent-04/index.html">
          MyRent-04
        </a>
      
    
      
        <a class="item" href="../../topic05-listview-and-lifecycles/book-c-myrent-05/index.html">
          MyRent-05
        </a>
      
    
      
        <a class="item" href="../../topic05-listview-and-lifecycles/book-d-event-handler-soln/index.html">
          Event-Handling-Solution
        </a>
      
    
      
        <a class="item" href="../../topic06-streams-and-fileio/book-a/index.html">
          MyRent-06
        </a>
      
    
      
        <a class="item" href="../../topic06-streams-and-fileio/book-b/index.html">
          MyRent-07
        </a>
      
    
      
        <a class="item" href="../../topic07-tdd-and-fragments/book-a/index.html">
          TDD-01
        </a>
      
    
      
        <a class="item" href="../../topic07-tdd-and-fragments/book-b/index.html">
          MyRent-08
        </a>
      
    
      
        <a class="item" href="../../topic08-jpa-and-maps/book-a-jpa-01/index.html">
          JPA-01
        </a>
      
    
      
        <a class="item" href="../../topic08-jpa-and-maps/book-b-jpa-02/index.html">
          JPA-02
        </a>
      
    
      
        <a class="item" href="../../topic08-jpa-and-maps/book-c-myrent-09/index.html">
          MyRent-09
        </a>
      
    
      
        <a class="item" href="../../topic09-rest-services/book-a-donation-04/index.html">
          Donation-04
        </a>
      
    
      
        <a class="item" href="../../topic09-rest-services/book-b-donation-05/index.html">
          Donation-05
        </a>
      
    
      
        <a class="active item" href="../../topic09-rest-services/book-c-donation-06/index.html">
          Donation-06
        </a>
      
    
      
        <a class="item" href="../../topic10-rest-client/book-a-donation-07/index.html">
          Donation-07
        </a>
      
    
      
        <a class="item" href="../../topic10-rest-client/book-b-donation-08/index.html">
          Donation-08
        </a>
      
    
      
        <a class="item" href="../../topic10-rest-client/book-c-assign2-studio/index.html">
          MyTweet-Assignment-Studio
        </a>
      
    
      
        <a class="item" href="../../topic11-assignment-studio/book-a-donation-09/index.html">
          Donation-09
        </a>
      
    
      
        <a class="item" href="../../topic11-assignment-studio/book-b-assign2-studio/index.html">
          MyTweet-Assignment-Studio-01
        </a>
      
    
      
        <a class="item" href="../../topic12-android-services/book-a-donation-10/index.html">
          Donation-10
        </a>
      
    
      
        <a class="item" href="../../topic12-android-services/book-b-assign2-studio/index.html">
          MyTweet-Assignment-Studio-02
        </a>
      
    
      
        <a class="item" href="../../topic12-android-services/book-c-assign2-studio/index.html">
          MyTweet-Assignment-Studio-03
        </a>
      
    
  </div>
  <div class="pusher">
    <div class="ui basic segment">
      <br>
      
      <div  class="ui tab segment lab" data-tab="Donation-06">
        <h1>Objectives</h1>
<p>Deploy the donation-service app to Heroku. This will require a heroku account + a locally installed git tool set.</p>

      </div>
     
      <div  class="ui tab segment lab" data-tab="01">
        <h1>Git Bash</h1>
<p>This step applies to Windows only. </p>
<ul>
<li>The word terminal as used in this lab refers to Git Bash terminal where you are working in Windows and the default terminal in the case of Linux.</li>
</ul>
<p>If your operating system is a Linux variant then you may run this lab using the default terminal.</p>
<p>Download and install <a href="http://git-scm.com/downloads">Git for Windows</a>.</p>
<ul>
<li>This will be used in this lab. We shall refer to as <em>Git Bash</em>.</li>
</ul>
<p><img src="img/heroku_022.png" alt="Figure 1: Installation Wizard Git Bash"></p>
<p>All the following commands should be run within the Git Bash terminal, not the standard windows terminal (Command Prompt).</p>

      </div>
     
      <div  class="ui tab segment lab" data-tab="02">
        <h1>Managing SSH Keys</h1>
<p>This step provides guidance on how to manage ssh keys.</p>
<p>Official Heroku documentation on managing SSH keys is available <a href="https://devcenter.heroku.com/articles/keys#adding-keys-to-heroku">here</a></p>
<p>Useful information is also availabe on the GitHub site: <a href="https://help.github.com/articles/generating-ssh-keys/">Generating SSH Keys</a>.</p>
<p>Your computer will communicate with Heroku using <a href="http://en.wikipedia.org/wiki/Secure_Shell">Secure Shell</a> (SSH).</p>
<p>Check for the presence of an ssh client application on your computer by running this command in a terminal.</p>
<pre><code>ssh -v</code></pre>
<p>The response should be similar to this:</p>
<p><img src="img/heroku_001.png" alt="Figure 1: Verify presence of SSH client"></p>
<p>Check if you already have SSH keys by verifying the presence of an <strong>.ssh</strong> folder and if it exists, listing its contents:</p>
<pre><code>ls -l ~/.ssh</code></pre>
<p>Note that <strong>~</strong> is shorthand for your home directory.</p>
<p>If keys are present then the response should be something simiar to that shown in Figure 2:</p>
<p><img src="img/heroku_002.png" alt="Figure 2: SSH Keys"></p>
<p>If keys are not present then generate a key pair (private and public key set) with this command:</p>
<pre><code> ssh-keygen -t rsa</code></pre>
<p>Accept the default prompts, providing a passphrase when prompted to secure your private key.</p>
<p>Confirm that keys have been successfully generated by checking the contents of the <em>.ssh</em> folder which should be somewhat similar to that shown in Figure 3 above.</p>
<p>It is important that if other users have access to your computer you make a copy of your ssh keys on a separate medium, such as a USB key. You are advised to delete your private key at the end of your lab. Here are some typical commands:</p>
<p>Change into your .ssh folder:</p>
<pre><code>cd ~/.ssh</code></pre>
<p>Attach a USB drive and either use file manager to copy the private key or do so from the terminal. Here it is assumed you are using the default key names.</p>
<pre><code>cp id_rsa path_to_your_usb_medium/usb_medium</code></pre>
<p>The command df may help identify your usb key - see Figure 3.</p>
<pre><code>df
cp ~/ssh.zip /media/ictskills/LINUX-LIVEC/</code></pre>
<p><img src="img/heroku_027.png" alt="Figure 3: Using df command in Linux environment to determine path to attached USB device">.</p>
<p>You can make a copy of your keys by compressing the .ssh folder and its contents to a file <em>ssh.zip</em> as follows:</p>
<pre><code>// Ensure you are in home directory
cd ~
// Compress the .ssh folder and its contents
zip -r ssh.zip .ssh</code></pre>
<p>Once you have made a copy, delete your ssh private key. </p>
<pre><code>rm id_rsa</code></pre>
<p>On the next occasion that you will require the use of the key simply copy the ssh.zip file from your memory key to the Downloads folder, unpack the file and move its contents to the .ssh folder.</p>
<pre><code>unzip ssh.zip
mv ssh/id_rsa ~/.ssh/
mv ssh/id_rsa.pub ~/.ssh/</code></pre>

      </div>
     
      <div  class="ui tab segment lab" data-tab="03">
        <h1>Local Repository</h1>
<p>It is assumed you are working with the project <em>donation-service-2015</em>, developed earlier:</p>
<ul>
<li>Delete the file Bootstrap.java (if it exists).<ul>
<li>Alternatively, simply comment out its contents and leave the file in place for possible future use as shown in Figure 1.</li>
</ul>
</li>
</ul>
<p><img src="img/heroku_029.png" alt="Figure 1: Disable Bootstrap.java"></p>
<p>If the .gitignore file is not present you could create one as follows at the root of the project:</p>
<pre><code># Ignore all dotfiles...
.*
# except for .gitignore
!.gitignore
bin
documentation

# Ignore Play! working directory #
war
db
eclipse
lib
log
logs
modules
precompiled
project/project
project/target
crud/*
data/*
conf/crud/*
conf/cloudbees*
public/crud/*
target
tmp
test-result
server.pid
*.iml
*.eml</code></pre>
<ul>
<li>In the same folder, create and a file named <strong>ProcFile</strong> containing the following:</li>
</ul>
<pre><code>web: play run --http.port=$PORT $PLAY_OPTS</code></pre>
<p>This next item applies only if the models package contains a class named <em>User</em>:</p>
<ul>
<li>Open the &#39;Users&#39; model file and adjust the the class as follows:</li>
</ul>
<pre><code>@Entity
@Table(name=&quot;`User`&quot;) //This is necessary because User is a reserved word in PostGreSQL
public class User extends Model</code></pre>
<p>&#39;User&#39; is a reserved table name in the database, so we change it to something slightly different.</p>
<p>This next step applies if a .git repository does not exist in the project folder:</p>
<ul>
<li>In a terminal, <em>cd</em> into the folder containing your donation-service-2015 project, and create a git repository for the project:</li>
</ul>
<pre><code>git init</code></pre>
<p>If a .git folder is already present, remove the origin as follows:</p>
<pre><code>git remote rm origin</code></pre>
<p>Continue as follows:</p>
<p>Add all files (except those matched by .gitignore) to the repo and commit:</p>
<pre><code>git add .
git commit -m &#39;commit prior to upload to Heroku&#39;</code></pre>
<p>Verify by running the command</p>
<pre><code>git status</code></pre>
<p>The response should as follow:</p>
<p><img src="img/heroku_016.png" alt=""></p>

      </div>
     
      <div  class="ui tab segment lab" data-tab="04">
        <h1>Heroku repository</h1>
<p>Create an account on <a href="http://www.heroku.com">Heroku</a>. Note carefully your login and password.</p>
<p>Download and install <a href="https://toolbelt.heroku.com">Heroku Toolbelt for appropriate to your operating system</a>. You may be prompted to close and reopen the terminal following installation of Toolbelt. </p>
<ul>
<li>In the case of Linux Mint the required tool belt is that applying to Debian/Ubuntu. It may be installed by an administrator by running this command:</li>
</ul>
<pre><code>wget -O- https://toolbelt.heroku.com/install-ubuntu.sh | sh</code></pre>
<p><img src="img/heroku_030.png" alt="Figure 1: Download heroku toolbelt"></p>
<p>Once installed, verify installation ok by typing </p>
<pre><code>heroku --version</code></pre>
<p>The response should be something like this:</p>
<p><img src="img/heroku_026.png" alt="Figure 1: Check heroku version"></p>
<p>Login in to your heroku account from Git Bash</p>
<pre><code>heroku login</code></pre>
<p>You will be prompted for you email and password. Successful authentication will be confirmed. </p>
<p>Next create an app and repository on Heroku as follows:</p>
<pre><code>heroku create</code></pre>
<p>The response will be something like this:</p>
<p><img src="img/heroku_003.png" alt="Figure 2: Heroku: app and repository created"></p>
<p>Notice the default name assigned by Heroku to the remote app.</p>
<p>Verify with the command </p>
<pre><code>git remote -v</code></pre>
<p>and observe a response similar to that in Figure 3.</p>
<p><img src="img/heroku_004.png" alt="Figure 3: Checking remote repo on Heroku"></p>
<p>Now add your SSH keys to Heroku:</p>
<pre><code>heroku keys:add</code></pre>
<p><img src="img/heroku_005.png" alt="Figure 4: Heroku: Adding SSH Keys"></p>
<p>Finally, push the local repo to Heroku:</p>
<pre><code>git push heroku master</code></pre>
<p>The response should be somewhat similar to that shown in Figure 5.</p>
<p><img src="img/heroku_006.png" alt="Figure 5: Successful deployment"></p>
<p>Aside: in the event that you wish to push a branch, not the master, to heroku, here is the command to run:</p>
<pre><code>git push -f heroku local-topic-branch:refs/heads/master</code></pre>
<p>We shall now test the service: In the specific case of this lab we have been randomly assigned a remote Heroku repo named <em>guarded-reef-267.git</em>. The convention for construction a URI to access this repo or service can easily be deduced by studying the URI for this specific service:</p>
<pre><code>http://guarded-reef-2677.herokuapp.com/api/users</code></pre>
<p>The portions <strong>/api/users</strong> is determined by how we, the developers, wrote the application (<em>donation-service</em>). Notice where the actual name of the repo is located in the URI:</p>
<pre><code>- guarded-reef-2677</code></pre>
<p>Copy this URI into a browser&#39;s navigation bar: unfortunately an application error is flagged. The reason for this is that we have not set up a suitable database on Heroku. We shall attend to this shortly.</p>
<h3>Changing name of Heroku app</h3>
<p>We shall now change the Heroku-assigned name <em>guarded-reef-2677</em> to a more meaningful name <em>org-wit-donation-service-id</em> where <strong>id</strong> is your email address excluding @, periods, underscores and so on. For example john_doe@organs.com becomes johndoeorganscom. This is just a suggestion to ensure that the name you choose for the app on Heroku will be unique.</p>
<p>Run the following command within the Heroku terminal, replacing <em>id</em> with your student id, for example. </p>
<ul>
<li>You could also try a UUID. The idea is to create a name that will not clash with existing repository names in the Heroku domain.</li>
</ul>
<pre><code>heroku apps:rename donation-service-yourStudentID</code></pre>
<p>A typical response is shown in Figure 6:</p>
<p><img src="img/heroku_007.png" alt="Figure 6: Changing name of Heroku app from command line"></p>

      </div>
     
      <div  class="ui tab segment lab" data-tab="05">
        <h1>Heroku Database</h1>
<p>You created a Heroku app in an earlier step (using the command <em>heroku create</em>) </p>
<ul>
<li>A database was made available as part of the app creation process.</li>
<li>You can verify this by running the following command:</li>
</ul>
<pre><code>heroku pg:info</code></pre>
<p>A typical response is depicted in Figure 1.</p>
<p><img src="img/heroku_012.png" alt="Figure 1: Database information"></p>
<p>In this case the DATABASE_URL is HEROKU_POSTGRESQL_MAUVE_URL.</p>
<p>Log in to <a href="https://dashboard-next.heroku.com/apps/">Heroku</a> website for more detailed information such as is shown here in Figure 2 for the current project.</p>
<p><img src="img/heroku_025.png" alt="Figure 2: App and associated database details on Heroku site"></p>
<p>In order to make use of this database do the following:</p>
<ul>
<li>Modify the <em>application.conf</em> file:<ul>
<li>Comment out any database activation statements such as, for example, <em>db = mem</em>.</li>
<li>Add the following block to the end of the file.</li>
</ul>
</li>
</ul>
<pre><code>#================heroku databse config config=========================
db=${DATABASE_URL}
jpa.dialect=org.hibernate.dialect.PostgreSQLDialect
jpa.ddl=update
#================end database config heroku config====================</code></pre>
<ul>
<li>In the Heroku terminal add and commit the changes:</li>
</ul>
<pre><code>git add .
git commit -m &#39;database configured&#39;
git push heroku master</code></pre>
<p>The response should be similar to that shown in Figure 3.
<img src="img/heroku_010.png" alt="Figure 3: Application + configured database pushed to remote heroku repo"></p>
<p><strong>Test App</strong></p>
<p>You can test that the application is working correctly in a number of ways, listed here:</p>
<ul>
<li>Run the following command: output similar to that in Figure 4 indicates your app has been successfully deployed.</li>
</ul>
<pre><code>heroku ps</code></pre>
<p><img src="img/heroku_023.png" alt="Figure 4: Successful deployment"></p>
<ul>
<li>Next run the command to open a browser: Figure 5 shows the command and additionally the response to the command and the output in the browser if the app is running correctly.</li>
</ul>
<pre><code>heroku open</code></pre>
<p><img src="img/heroku_024.png" alt="Figure 5: Application ready"></p>
<ul>
<li>Finally, introduce this URI in a browser&#39;s navigation bar: the expected response is shown here in Figure 6:</li>
</ul>
<pre><code>http://org-wit-donation-service-id.herokuapp.com/api/donors</code></pre>
<p><img src="img/heroku_011.png" alt="Figure 6: List of donors returned in resonse to query"></p>
<p><strong>Reset Database</strong></p>
<p>You can reset the database as described below. But if you do, then it will be necessary to push the application again.</p>
<ul>
<li>First obtain the DATABASE_URL with the following command:</li>
</ul>
<pre><code>heroku pg:info</code></pre>
<p>A typical response is depicted in Figure 7.</p>
<p><img src="img/heroku_012.png" alt="Figure 7: Database information"></p>
<p>In this case the DATABASE_URL is HEROKU_POSTGRESQL_MAUVE_URL. The command to run to reset is:</p>
<pre><code>heroku pg:reset HEROKU_POSTGRESQL_MAUVE_URL</code></pre>
<p>Follow the instructions as indicated in Figure 8.</p>
<p><img src="img/heroku_013.png" alt="Figure 8: Resetting the database"></p>
<p><strong>References</strong></p>
<p><a href="https://devcenter.heroku.com/articles/git">Deploying with Git</a></p>

      </div>
     
      <div  class="ui tab segment lab" data-tab="Exercises">
        <h1>Exercises</h1>
<h2>Exercise 1:</h2>
<p>Using postman, create a few Users and Donations on the app hosted in heroku. Verify that the creation/deleting proceeds as expected</p>
<h2>Exercise 2:</h2>
<p>You have some tests in the donation-service-test project, which currently tests the app running on localhost. Change this app such that it will test the application you have now deployed to heroku.  A one line change to the Rest class should be sufficient.</p>

      </div>
     
    </div>
  </div>
</div>
  <div class="ui bottom fixed borderless right menu">
    <div class="ui right tiny menu">
      <div class="ui mini message segment">
        Eamonn de Leastar (edeleastar@tssg.wit.ie) & John Fitzgerald (johnjfitzgerald@outlook.com).
        <a  href="http://creativecommons.org/licenses/by-nc/4.0/" title="External link to http://creativecommons.org/licenses/by-nc/4.0/"
            target="_blank">Creative Commons License
        </a>
      </div>
    </div>
  </div>

    <footer>

    </footer>
    <script>
      
$(document).ready(function()
{
  $("img").addClass ("ui image");
  $('.ui.embed').embed();

  var images = $(".lab img");
  jQuery.each(images, function(i)  {
    if((images[i].alt).length > 0)
    {
      var div_img = $(document.createElement("div")).addClass("ui segment");
      $(images[i]).wrap(div_img);
      var div_label = $(document.createElement("div")).addClass("ui ribbon teal top attached label");
      div_label.append(images[i].alt);
      $(div_label).insertBefore(images[i]);
    }
  });


  $('.ui.menu .item')
      .tab({
        history: true,
        historyType: 'hash',
      });

  $('.popup').popup();

  $('.ui.sidebar')
      .sidebar({ context: $('.pushable') })
      .sidebar('setting', 'transition', 'slide out')
      .sidebar('attach events', '#toc');
});

    </script>
  </body>

 </html>