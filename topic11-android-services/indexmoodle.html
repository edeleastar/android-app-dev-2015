<!DOCTYPE html>
<html>
  <head>
    <link href='//fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.1.4/semantic.min.css" type="text/css">
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.1.4/semantic.min.js"></script>
    <style>


body 
{
  font-family: "Open Sans", "Helvetica", "Helvetica Neue",  "Arial", sans-serif;
}

figcaption
{
  margin-bottom: 20px;
}

.vertical-align
{
  display: flex;
  align-items: center;
}

.credits
{
  min-height:20px;
}
    </style>
    <base target="_blank" />
  </head>
  <body>
    <div class="ui raised segment">
<div class="ui four doubling stackable cards">
      <a class="ui card" href="http://wit-computing.github.io/android-app-dev-2015/topic11-android-services/book-a/index.html">
    <div class="content">
      <div class="right floated meta"> <i class="lab large icon"></i></div>
      <div class="header"> Donation-09 </div>
    </div>
    <div class="ui bordered rounded image">
      <img src="http://wit-computing.github.io/android-app-dev-2015/topic11-android-services/book-a/img/main.png">
    </div>
    <div class="content">
      <div class="description">
         <p>Using the latest Semantic UI, introduce a simple but well structured User Interface into the donation-service-play application.</p>
      </div>
    </div>
  </a>

      <a class="ui card" href="http://wit-computing.github.io/android-app-dev-2015/topic11-android-services/book-b/index.html">
    <div class="content">
      <div class="right floated meta"> <i class="lab large icon"></i></div>
      <div class="header"> 05 </div>
    </div>
    <div class="ui bordered rounded image">
      <img src="http://wit-computing.github.io/android-app-dev-2015/topic11-android-servicesone">
    </div>
    <div class="content">
      <div class="description">
         <p>Here we shall create RefreshService, a subclass of Android's <a href="http://developer.android.com/reference/android/app/IntentService.html">IntentService</a>.</p>
<p>Create a package <em>app.donation.services</em>.</p>
<p>In this package create a new class, RefreshService that subclasses IntentService:</p>
<pre><code>package app.donation.services;

public class RefreshService extends IntentService
{
  private String tag = &quot;Donation&quot;;
  DonationApp app;

  public RefeshService()
  {
    super(&quot;RefreshService&quot;);

  }
}
</code></pre>

<p>Add an import statement for IntentService:</p>
<pre><code>import android.app.IntentService;
</code></pre>

<p>Add unimplemented method:</p>
<pre><code>  @Override
  protected void onHandleIntent(Intent intent)
  {
    // TODO Auto-generated method stub

  }
</code></pre>

<p>An import for Intent is required:</p>
<pre><code>import android.content.Intent;
</code></pre>

<p>The code should now be error free.</p>
<p>The method <em>onHandleIntent</em> runs on a worker thread once an instance of RefreshService is started. </p>
<ul>
<li>when the method has been executed the service automatically stops.</li>
</ul>
<p>In onHandleIntent we shall:</p>
<ul>
<li>Obtain a reference to DonationApp,</li>
<li>Create an Intent for broadcast,</li>
<li>Make a synchonous network call to retrieve the list of donations,</li>
<li>Save the list to DonationApp,</li>
<li>Broadcast the intent.</li>
</ul>
<pre><code>  @Override
  protected void onHandleIntent(Intent intent)
  {
    app = (DonationApp) getApplication();
    Intent localIntent = new Intent(Report.BROADCAST_ACTION);
    Call&lt;List&lt;Donation&gt;&gt; call = (Call&lt;List&lt;Donation&gt;&gt;) app.donationService.getAllDonations();
    try
    {
      Response&lt;List&lt;Donation&gt;&gt; response = call.execute();
      app.donations = response.body();
      LocalBroadcastManager.getInstance(this).sendBroadcast(localIntent);
    }
    catch (IOException e)
    {
      LogHelpers.info(tag, &quot;Failed to retrieve donations list - network error&quot;);
    }
  }
</code></pre>

<p>Add an onDestroy method, soley for the purpose of creating a log entry:</p>
<pre><code>  @Override
  public void onDestroy()
  {
    super.onDestroy();
    LogHelpers.info(this, &quot;onDestroyed&quot;);
  }
</code></pre>

<p>For reference, here is the complete class:</p>
<pre><code>package app.donation.services;

import android.app.IntentService;
import android.content.Intent;
import android.support.v4.content.LocalBroadcastManager;

import java.io.IOException;
import java.util.List;

import app.android.helpers.LogHelpers;
import app.donation.activity.Report;
import app.donation.main.DonationApp;
import app.donation.model.Donation;
import retrofit.Call;
import retrofit.Response;

public class RefreshService extends IntentService
{
  private String tag = &quot;Donation&quot;;
  DonationApp app;
  public RefreshService()
  {
    super(&quot;RefreshService&quot;);
  }

  @Override
  protected void onHandleIntent(Intent intent)
  {
    app = (DonationApp) getApplication();
    Intent localIntent = new Intent(Report.BROADCAST_ACTION);
    Call&lt;List&lt;Donation&gt;&gt; call = (Call&lt;List&lt;Donation&gt;&gt;) app.donationService.getAllDonations();
    try
    {
      Response&lt;List&lt;Donation&gt;&gt; response = call.execute();
      app.donations = response.body();
      LocalBroadcastManager.getInstance(this).sendBroadcast(localIntent);
    }
    catch (IOException e)
    {
      LogHelpers.info(tag, &quot;Failed to retrieve donations list - network error&quot;);
    }
  }

  @Override
  public void onDestroy()
  {
    super.onDestroy();
    LogHelpers.info(tag, &quot;RefreshService instance destroyed&quot;);
  }

}
</code></pre>
      </div>
    </div>
  </a>

  </div>
    </div>
  </body>
 </html>