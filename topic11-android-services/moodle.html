<!DOCTYPE html>
 <html>
   <head>
     <link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
     <meta charset="utf-8">
     <meta name="viewport" content="width=device-width, initial-scale=1">
     <link href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css" rel="stylesheet" type="text/css">
     <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
     <script type="text/javascript" src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
  </head>
  <body>

 <div class="row">
</div>

 <div class="row">
      <div class="col-md-6">
         <div class="panel panel-danger">
     <div class="panel-heading">
       <div class="panel-title">
         <a href="http://wit-computing.github.io/android-app-dev-2015/topic11-android-services/book-a/index.html"> Donation-09 </a>
       </div>
     </div>
     <div class="panel-body">
       <div class="thumbnail">
         <img src="http://wit-computing.github.io/android-app-dev-2015/topic11-android-services/book-a/img/main.png"  class="img-responsive col-lg-12">
       </div>
        <blockquote>
          <p>Using the latest Semantic UI, introduce a simple but well structured User Interface into the donation-service-play application.</p>
       </blockquote>
     </div>
   </div>

      </div>
      <div class="col-md-6">
         <div class="panel panel-danger">
     <div class="panel-heading">
       <div class="panel-title">
         <a href="http://wit-computing.github.io/android-app-dev-2015/topic11-android-services/book-b/index.html"> 05 </a>
       </div>
     </div>
     <div class="panel-body">
       <div class="thumbnail">
         <img src="http://wit-computing.github.io/android-app-dev-2015/topic11-android-servicesone"  class="img-responsive col-lg-12">
       </div>
        <blockquote>
          <p>Here we shall create RefreshService, a subclass of Android's <a href="http://developer.android.com/reference/android/app/IntentService.html">IntentService</a>.</p>
<p>Create a package <em>app.donation.services</em>.</p>
<p>In this package create a new class, RefreshService that subclasses IntentService:</p>
<pre><code>package app.donation.services;

public class RefreshService extends IntentService
{
  private String tag = &quot;Donation&quot;;
  DonationApp app;

  public RefeshService()
  {
    super(&quot;RefreshService&quot;);

  }
}
</code></pre>

<p>Add an import statement for IntentService:</p>
<pre><code>import android.app.IntentService;
</code></pre>

<p>Add unimplemented method:</p>
<pre><code>  @Override
  protected void onHandleIntent(Intent intent)
  {
    // TODO Auto-generated method stub

  }
</code></pre>

<p>An import for Intent is required:</p>
<pre><code>import android.content.Intent;
</code></pre>

<p>The code should now be error free.</p>
<p>The method <em>onHandleIntent</em> runs on a worker thread once an instance of RefreshService is started. </p>
<ul>
<li>when the method has been executed the service automatically stops.</li>
</ul>
<p>In onHandleIntent we shall:</p>
<ul>
<li>Obtain a reference to DonationApp,</li>
<li>Create an Intent for broadcast,</li>
<li>Make a synchonous network call to retrieve the list of donations,</li>
<li>Save the list to DonationApp,</li>
<li>Broadcast the intent.</li>
</ul>
<pre><code>  @Override
  protected void onHandleIntent(Intent intent)
  {
    app = (DonationApp) getApplication();
    Intent localIntent = new Intent(Report.BROADCAST_ACTION);
    Call&lt;List&lt;Donation&gt;&gt; call = (Call&lt;List&lt;Donation&gt;&gt;) app.donationService.getAllDonations();
    try
    {
      Response&lt;List&lt;Donation&gt;&gt; response = call.execute();
      app.donations = response.body();
      LocalBroadcastManager.getInstance(this).sendBroadcast(localIntent);
    }
    catch (IOException e)
    {
      LogHelpers.info(tag, &quot;Failed to retrieve donations list - network error&quot;);
    }
  }
</code></pre>

<p>Add an onDestroy method, soley for the purpose of creating a log entry:</p>
<pre><code>  @Override
  public void onDestroy()
  {
    super.onDestroy();
    LogHelpers.info(this, &quot;onDestroyed&quot;);
  }
</code></pre>

<p>For reference, here is the complete class:</p>
<pre><code>package app.donation.services;

import android.app.IntentService;
import android.content.Intent;
import android.support.v4.content.LocalBroadcastManager;

import java.io.IOException;
import java.util.List;

import app.android.helpers.LogHelpers;
import app.donation.activity.Report;
import app.donation.main.DonationApp;
import app.donation.model.Donation;
import retrofit.Call;
import retrofit.Response;

public class RefreshService extends IntentService
{
  private String tag = &quot;Donation&quot;;
  DonationApp app;
  public RefreshService()
  {
    super(&quot;RefreshService&quot;);
  }

  @Override
  protected void onHandleIntent(Intent intent)
  {
    app = (DonationApp) getApplication();
    Intent localIntent = new Intent(Report.BROADCAST_ACTION);
    Call&lt;List&lt;Donation&gt;&gt; call = (Call&lt;List&lt;Donation&gt;&gt;) app.donationService.getAllDonations();
    try
    {
      Response&lt;List&lt;Donation&gt;&gt; response = call.execute();
      app.donations = response.body();
      LocalBroadcastManager.getInstance(this).sendBroadcast(localIntent);
    }
    catch (IOException e)
    {
      LogHelpers.info(tag, &quot;Failed to retrieve donations list - network error&quot;);
    }
  }

  @Override
  public void onDestroy()
  {
    super.onDestroy();
    LogHelpers.info(tag, &quot;RefreshService instance destroyed&quot;);
  }

}
</code></pre>
       </blockquote>
     </div>
   </div>

      </div>
 <div>

  </body>
</html>