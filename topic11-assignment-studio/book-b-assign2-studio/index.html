 <!DOCTYPE html>
 <html>
   <head>

     <link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>

     <meta charset="utf-8">
     <meta name="viewport" content="width=device-width, initial-scale=1">

     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.4/semantic.min.css" type="text/css">
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/styles/solarized_light.min.css" rel="stylesheet" />

     <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
     <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery.address/1.6/jquery.address.min.js"></script>
     <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.4/semantic.min.js"></script>
     <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/highlight.min.js"></script>
     <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/languages/java.min.js"></script>
     <script>hljs.initHighlightingOnLoad();</script>

      <style>
        

body 
{
  font-family: "Open Sans", "Helvetica", "Helvetica Neue",  "Arial", sans-serif;
}

figcaption
{
  margin-bottom: 20px;
}

.vertical-align
{
  display: flex;
  align-items: center;
}



    </style>

  </head>

  <body>
    

<style>
  

code
{
  font-family: "Monaco";
  font-size: 110%;
}

img
{
  padding:1px;
  border:1px solid black;
}

h1
{
  font-style:italic;
  font-size:130%;
  border-bottom: thin solid black;
}
h2
{
  font-size:110%;
  border-bottom: thin solid black;
}
h3
{
  font-size:100%;
  border-bottom: thin solid black;
}



</style>

<div class="ui fixed top pointing inverted menu labmenu">
  <header class="header item">
    <i id="toc" class="sitemap icon"></i>
    <a href="../index.html">
      11: Assignment Studio
    </a>
  </header>
  <div class="right tab-menu menu">
    
    <a class="item" data-tab="MyTweet-Assignment-Studio-01">
      MyTweet-Assignment-Studio-01
    </a>
    
    <a class="item" data-tab="01">
      01
    </a>
    
    <a class="item" data-tab="02">
      02
    </a>
    
    <a class="item" data-tab="03">
      03
    </a>
    
    <a class="item" data-tab="04">
      04
    </a>
    
    <a class="item" data-tab="05">
      05
    </a>
    
    <a class="item" data-tab="06">
      06
    </a>
    
    <a class="item" data-tab="07">
      07
    </a>
    
    <a class="item" data-tab="08">
      08
    </a>
    
    <a class="item" data-tab="09">
      09
    </a>
    
    <a class="item" data-tab="10">
      10
    </a>
    
    <a class="item" data-tab="11">
      11
    </a>
    
    <a class="item" href="../../index.html">
      <i class="home icon"></i>
    </a>
  </div>
</div>

<div class="ui segment pushable">
  <div class="ui inverted labeled icon left inline vertical sidebar menu">
    
      
        <a class="item" href="../../topic01-overview-and-tools/book-a-android-tools-01/index.html">
          Android-Tools-01
        </a>
      
    
      
        <a class="item" href="../../topic01-overview-and-tools/book-b-donation-01/index.html">
          Donation-01
        </a>
      
    
      
        <a class="item" href="../../topic01-overview-and-tools/book-c-android-tools-02/index.html">
          Android-Tools-02
        </a>
      
    
      
        <a class="item" href="../../topic02-activities-and-layouts/book-a-donation-02/index.html">
          Donation-02
        </a>
      
    
      
        <a class="item" href="../../topic03-navigation-and-app-structure/book-a-donation-03/index.html">
          Donation-03
        </a>
      
    
      
        <a class="item" href="../../topic03-navigation-and-app-structure/book-b-myrent-00/index.html">
          MyRent-00
        </a>
      
    
      
        <a class="item" href="../../topic03-navigation-and-app-structure/book-c-myrent-01/index.html">
          MyRent-01
        </a>
      
    
      
        <a class="item" href="../../topic04-widgets-and-events/book-a-myrent-02/index.html">
          MyRent-02
        </a>
      
    
      
        <a class="item" href="../../topic04-widgets-and-events/book-b-event-handling/index.html">
          Event-Handling
        </a>
      
    
      
        <a class="item" href="../../topic05-listview-and-lifecycles/book-a-myrent-03/index.html">
          MyRent-03
        </a>
      
    
      
        <a class="item" href="../../topic05-listview-and-lifecycles/book-b-myrent-04/index.html">
          MyRent-04
        </a>
      
    
      
        <a class="item" href="../../topic05-listview-and-lifecycles/book-c-myrent-05/index.html">
          MyRent-05
        </a>
      
    
      
        <a class="item" href="../../topic05-listview-and-lifecycles/book-d-event-handler-soln/index.html">
          Event-Handling-Solution
        </a>
      
    
      
        <a class="item" href="../../topic06-streams-and-fileio/book-a/index.html">
          MyRent-06
        </a>
      
    
      
        <a class="item" href="../../topic06-streams-and-fileio/book-b/index.html">
          MyRent-07
        </a>
      
    
      
        <a class="item" href="../../topic07-tdd-and-fragments/book-a/index.html">
          TDD-01
        </a>
      
    
      
        <a class="item" href="../../topic07-tdd-and-fragments/book-b/index.html">
          MyRent-08
        </a>
      
    
      
        <a class="item" href="../../topic08-jpa-and-maps/book-a-jpa-01/index.html">
          JPA-01
        </a>
      
    
      
        <a class="item" href="../../topic08-jpa-and-maps/book-b-jpa-02/index.html">
          JPA-02
        </a>
      
    
      
        <a class="item" href="../../topic08-jpa-and-maps/book-c-myrent-09/index.html">
          MyRent-09
        </a>
      
    
      
        <a class="item" href="../../topic09-rest-services/book-a-donation-04/index.html">
          Donation-04
        </a>
      
    
      
        <a class="item" href="../../topic09-rest-services/book-b-donation-05/index.html">
          Donation-05
        </a>
      
    
      
        <a class="item" href="../../topic09-rest-services/book-c-donation-06/index.html">
          Donation-06
        </a>
      
    
      
        <a class="item" href="../../topic10-rest-client/book-a-donation-07/index.html">
          Donation-07
        </a>
      
    
      
        <a class="item" href="../../topic10-rest-client/book-b-donation-08/index.html">
          Donation-08
        </a>
      
    
      
        <a class="item" href="../../topic10-rest-client/book-c-assign2-studio/index.html">
          MyTweet-Assignment-Studio
        </a>
      
    
      
        <a class="item" href="../../topic11-assignment-studio/book-a-donation-09/index.html">
          Donation-09
        </a>
      
    
      
        <a class="active item" href="../../topic11-assignment-studio/book-b-assign2-studio/index.html">
          MyTweet-Assignment-Studio-01
        </a>
      
    
      
        <a class="item" href="../../topic12-android-services/book-a-donation-10/index.html">
          Donation-10
        </a>
      
    
      
        <a class="item" href="../../topic12-android-services/book-b-assign2-studio/index.html">
          MyTweet-Assignment-Studio-02
        </a>
      
    
      
        <a class="item" href="../../topic12-android-services/book-c-assign2-studio/index.html">
          MyTweet-Assignment-Studio-03
        </a>
      
    
  </div>
  <div class="pusher">
    <div class="ui basic segment">
      <br>
      
      <div  class="ui tab segment lab" data-tab="MyTweet-Assignment-Studio-01">
        <h1>Objectives</h1>
<p>Create a walking skeleton of the Android <strong>MyTweet</strong> assignment 2 app. </p>

      </div>
     
      <div  class="ui tab segment lab" data-tab="01">
        <h1>Client-Server</h1>
<p>In this lab we develop a <a href="http://alistair.cockburn.us/Walking+skeleton">walking skeleton</a> of the MyTweet assignment application, building on your completed version of assignment 1.</p>
<p>The information provided should help you to:</p>
<ul>
<li>Develop the Android client-side app by continuing development of your assignment 1 MyTweet app.</li>
<li>Create the corresponding server-side Play app, deploying on both localhost and Heroku.</li>
<li>Create a JUnit app to test the system by creating, reading and deleting data across the network.</li>
<li>Create a web app.</li>
</ul>
<p>During the summer school we developed Donation, MyRent and WitPress apps using the Play framework.</p>
<ul>
<li>These were <a href="http://en.wikipedia.org/wiki/Web_application">web apps</a>. That is, they could be run in a web browser.</li>
<li>We deployed these apps both locally (localhost) and on the cloud (Heroku).<ul>
<li>In both cases the model data is tightly bound to (is part of) the application. </li>
</ul>
</li>
</ul>
<p>In this semester we have developed Donation, MyRent and MyTweet as mobile apps using the Android development framework.</p>
<ul>
<li>These are native Android apps and can be run on an emulator (Genymotion or Android) or on a physical device (Android Smart Phone or Tablet).</li>
<li>Unlike the summer school Play apps, these apps cannot be run in a web browser.</li>
<li>As with the Play apps, the data is tightly bound to the application.</li>
</ul>
<p>In this lab we:</p>
<ul>
<li><p>describe how to modify a MyTweet type app so that:</p>
<ul>
<li>The data may be transmitted across the network to be stored and manipulated in a customised Play app on a server. </li>
<li>The server may return data to MyTweet such as a list of tweets genererated in an earlier sessions.</li>
<li>The data may also be saved on the client-side in the MyTweet Android app. </li>
<li>The server may reside on the localhost or the cloud such as Heroku (or on both).</li>
</ul>
</li>
<li><p>develop a corresponding Play server-side web service app (MyTweet service):</p>
<ul>
<li>This app can be accessed by any client designed to consume the MyTweet service API.</li>
<li>In the case of this assignment you will be using the MyTweet native Android app to access this server app and also the JUnit test client.</li>
<li>You could, however, also develop other clients, such as iOS, Windows phone or web-based clients.<ul>
<li>This could be achieved without any modifications to the server app: the only requirement is that the client is suitably configured to communicate with the server api.</li>
</ul>
</li>
</ul>
</li>
<li><p>write a JUnit test app</p>
</li>
</ul>
<h2>MyTweet (Android client side app)</h2>
<p>MyTweet refactoring: This  essentially comprises the following steps:</p>
<ul>
<li>We add a suite of software (a HTTP API) to the Android client app (MyTweet) that allows it to communicate with a server-side app that we shall deploy in the cloud on Heroku.</li>
<li>At appropriate locations within the existing MyTweet app we will invoke http methods to communicate across the network with our server-side app and create, read and delete data, namely tweets or tweeters.<ul>
<li>Data that we read will be transmitted from the server and received by the client (MyTweet), stored in memory and also, optionally, on disk (depending on how you design your app).<ul>
<li>In this lab we have left the legacy serialization code in place so that server data, once transmitted to the client, is saved to a file.</li>
</ul>
</li>
<li>When MyTweet composes and tweets, the tweet will be transmitted across the network, received by the server-side app and stored in its model in the cloud.</li>
<li>When we delete tweets or tweeters, the data is deleted both on the phone or emulator and on the server.</li>
</ul>
</li>
</ul>
<h2>TweetService (Play server-side app)</h2>
<ul>
<li>We create a new Play app in the usual way.</li>
<li>The model layer is developed to closely mirror the model in the MyTweet client-side apps.</li>
<li>Initially we do not develop a set of views (templates) as was the case in the summer school projects.<ul>
<li>The MyTweet client-side app provides the view functionality.</li>
</ul>
</li>
</ul>
<p>A study of Figures 1, 2 and 3 below may provide further insight into the process.</p>
<p><img src="img/02.png" alt="Figure 1: Example of web Play app"></p>
<p><img src="img/01.png" alt="Figure 2: Example of native Android app"></p>
<p><img src="img/03.png" alt="Figure 3: Example of Android client-side and Play server-side apps"></p>

      </div>
     
      <div  class="ui tab segment lab" data-tab="02">
        <h1>Development</h1>
<p>In this lab we develop a <a href="http://alistair.cockburn.us/Walking+skeleton">walking skeleton</a> of the MyTweet assignment application, building on a completed version of assignment 1.</p>
<p>The assignment comprises the development of:</p>
<ul>
<li>Client-side  MyTweetTest app </li>
<li>Client-side MyTweet native Android app</li>
<li>Server-side TweetService app</li>
<li>Web app</li>
</ul>
<p>The server-side app should be deployed both on localhost and the cloud.</p>
<p>The MyTweetTest should test against the server-side app (TweetService) deployed on both localhost and the cloud.</p>
<p>The Android client app (MyTweet) should be tested against TweetService running on both localhost and the cloud.</p>
<p>Figure 1 illustrates this sequence.</p>
<p><img src="img/04.png" alt="Figure 1: Development phases"></p>
<p><strong>Suggested development approach</strong></p>
<p>Here is one approach you might consider adopting:</p>
<ul>
<li>Use git from the outset. Create individual repositories, one for each of service, service test client and Android client.<ul>
<li>Develop in iterations similar to how you developed the summer school labs.</li>
<li>Make regular commits, taking care with how you compose commit messages.</li>
<li>Add tags at key points in the development. Ensure that the choice of tag names is synchronized across the apps. This is important so that you may, if nessary, obtain a synchronized snapshot of your server and client at a particular point in the development.</li>
</ul>
</li>
<li>Build on the MyTweet developed in the first iteration.</li>
<li>The first app to develop should be the service app (TweetService).<ul>
<li>Ensure close correspondence between the model fields in both client and service apps. This will be further discussed later in the lab.</li>
</ul>
</li>
<li>Then write the test app and run against the server in localhost.<ul>
<li>Make liberal use of the Chrome extension <a href="https://chrome.google.com/webstore/detail/postman-rest-client/fdmmgilgnpjigdojojpjoooidkmcomcm?hl=en">PostMan - Rest client</a> in collaboration with the JUnit test app.</li>
</ul>
</li>
<li>Next refactor MyTweet to incorporate the <strong>http</strong> Retrofit client software similar to that provided in earlier labs (Donation). Http calls from a number of activities will be necessary in the completed application. Start with saving a tweet.</li>
<li>Run MyTweet (Android app) against the TweetService on localhost.</li>
<li>Deploy TweetService on Heroku.</li>
<li>Modify MyTweet to run against Heroku and test.</li>
<li>Repeat these steps in subsequent iterations.</li>
<li>Finally, develop a web app.</li>
</ul>

      </div>
     
      <div  class="ui tab segment lab" data-tab="03">
        <h1>Service</h1>
<p>Below are the outline steps to develop the server side Play app.</p>
<p>It is worth noting that whereas in this lab we send requests only from a native Android app and a JUnit test app, any network-enabled app that can consume the service api can engage in request-response sessions with TweetService.</p>
<p><img src="img/19.png" alt="Figure 1: TweetService cloud-based network"></p>
<p>Proceed as follows:</p>
<ul>
<li>Create a Play app: in a terminal, switch to the folder in which you wish the app to reside.<pre><code>play new TweetService</code></pre>
</li>
</ul>
<p>Then cd into <em>TweetService</em> folder and run:</p>
<pre><code>play eclipsify</code></pre>
<p>Import the project into your Eclipse workspace.</p>
<p>Activate the local database by uncommenting <em>#db.default=mem</em> in <em>conf/application.conf</em></p>
<p><img src="img/05.png" alt=""></p>
<p>Expand the folder structure and observe that the model folder is empty:</p>
<p><img src="img/06.png" alt="Figure 2: Default project layout"></p>
<p>The file structure of the completed application is illustrated in Figure 3. </p>
<ul>
<li>Observe that we have deleted the views folder.</li>
</ul>
<p><img src="img/07.png" alt="Figure 3: Project layout completed app"></p>
<p>A study of Figure 2 reveals the changes required:</p>
<ul>
<li>Model: <em>Tweet.java</em></li>
<li>utils folder containing file GsonBinder.java</li>
<li>controllers: TweetsAPI.java</li>
</ul>
<p>It will be necessary to refactor the default routes file. Here is a sample for you to modify as necessary.</p>
<pre><code>
# Routes
# This file defines all application routes (Higher priority routes first)
# ~~~~

# Home page
GET     /                                       Application.index

# Tweeter (the user)
GET     /api/tweeters                              TweetersAPI.getAllTweeters
GET     /api/tweeters/{id}                         TweetersAPI.getTweeter
POST    /api/tweeters                              TweetersAPI.createTweeter
DELETE  /api/tweeters/{id}                         TweetersAPI.deleteTweeter
DELETE  /api/tweeters                              TweetersAPI.deleteAllTweeters

# Tweet
GET     /api/tweets                                TweetsAPI.getAllTweets
DELETE  /api/tweets                                TweetsAPI.deleteAllTweets
GET     /api/tweeters/{id}/tweets                  TweetsAPI.getTweets
GET     /api/tweeters/{id}/tweets/{tweetId}        TweetsAPI.getTweet
POST    /api/tweeters/{id}/tweets                  TweetsAPI.createTweet
DELETE  /api/tweeters/{id}/tweets/{tweetId}        TweetsAPI.deleteTweet

# Ignore favicon requests
GET     /favicon.ico                            404

# Map static resources from the /app/public folder to the /public path
GET     /public/                                staticDir:public

# Catch all
*       /{controller}/{action}                  {controller}.{action}</code></pre>
<p>Here is the GsonBinder class:</p>
<pre><code>package utils;

import java.lang.annotation.Annotation;
import java.lang.reflect.Type;

import play.data.binding.Global;
import play.data.binding.TypeBinder;

import com.google.gson.JsonElement;
import com.google.gson.JsonParser;

@Global
public class GsonBinder implements TypeBinder&lt;JsonElement&gt;
{
  public Object bind(String name, Annotation[] notes, String value, Class toClass, Type toType) throws Exception
  {
    return new JsonParser().parse(value);
  }
}</code></pre>
<p>Here is the model code followed by some explanations:</p>
<pre><code>package models;

import javax.persistence.Entity;
import javax.persistence.Id;
import play.db.jpa.GenericModel;

@Entity
public class Tweet extends GenericModel
{
  @Id
  public String id;
  public String message;
  public String datestamp;

}</code></pre>
<p>Notice the following points regarding the model class Tweet:</p>
<ul>
<li>It extends GenericModel, not Model as in previous Play apps which we developed (Donation, MyRent, WitPress).</li>
<li>The annotation <strong>@Id</strong> means that we, the developers, are deciding the primary key, the <em>id</em> for the database table.<ul>
<li>The default Play behaviour to allow the framework to generate the id and assign it a value. </li>
<li>We are choosing a differerent approach in our application: the reason will be given when we develop the client.</li>
<li>It means also that the client will generate the id value and send it to the server app when a new Tweet is being created.</li>
</ul>
</li>
</ul>
<p>A key point to remember in designing this model class is that the field names we use here must be retained exactly in the client model.</p>
<ul>
<li>The access modifiers (public, private, protected) need not, however match.</li>
<li>The field types must also match those in the client model.</li>
<li>Thus we cannot have <em>String id</em> here and <em>UUID id</em> in the client model.</li>
</ul>
<p>Finally, here is the code for a subset of the API classes:</p>
<pre><code>package controllers;

import com.google.gson.Gson;
import com.google.gson.JsonElement;

import models.Tweet;
import play.mvc.Controller;

public class TweetsAPI extends Controller
{
  static Gson gson = new Gson();

  /**
   * 
   * @param id : intended for tweeter id in later iteration
   * @param body : the tweet to be created
   */
  public static void createTweet(String id, JsonElement body)
  {
    Tweet tweet = gson.fromJson(body.toString(), Tweet.class);
    tweet.save();
    renderJSON(gson.toJson(tweet));
  }
}</code></pre>
<pre><code>package controllers;

import java.util.List;

import com.google.gson.Gson;
import com.google.gson.JsonElement;

import models.Tweet;
import models.Tweeter;
import play.mvc.Controller;

public class TweetersAPI extends Controller
{
  static Gson gson = new Gson();

  public static void getAllTweeters()
  {
    List&lt;Tweeter&gt; Tweeters = Tweeter.findAll();
    renderJSON(gson.toJson(Tweeters));
  }

  public static void createTweeter(JsonElement body)
  {
    Tweeter tweeter = gson.fromJson(body.toString(), Tweeter.class);
    tweeter.save();
    renderJSON(gson.toJson(tweeter));
  }

}</code></pre>
<p>Test this service as follow:</p>
<ul>
<li>Add a data.yml file with some sample data:</li>
</ul>
<pre><code>Tweet(tweet_1):
    id: 39f5b200-898f-11e5-b435-0002a5d5c51b
    message: tweet_1
    datestamp: &#39;14-11-2015-08-20&#39;

Tweet(tweet_2):
    id: 56611600-898f-11e5-8369-0002a5d5c51b
    message: tweet_2
    datestamp: &#39;14-11-2015-08-21&#39;</code></pre>
<p>Add a Bootstrap class in the default package (root):</p>
<pre><code>import java.util.List;

import play.jobs.*;
import play.test.*;
import models.*;

@OnApplicationStart
public class Bootstrap extends Job 
{ 
  public void doJob()
  {
    if (Tweet.count() == 0)
    {
     Fixtures.deleteDatabase(); 
     Fixtures.loadModels(&quot;data.yml&quot;);
    }
  }
}</code></pre>
<ul>
<li>Launch the server from within the project folder in a terminal:</li>
</ul>
<pre><code>play run</code></pre>
<p>In a browser run:</p>
<pre><code>http://localhost:9000</code></pre>
<p>This should generate a blank screen. Attempt to determine why this is so.</p>
<p>Check the database. The output should be similar to that shown in Figure 4.</p>
<pre><code>http://localhost:9000/@db</code></pre>
<p><img src="img/20.png" alt="Figure 4: Database contains sample data loaded from yml file"></p>

      </div>
     
      <div  class="ui tab segment lab" data-tab="04">
        <h1>Test App</h1>
<p>A walking skeleton test app is available to download from <a href="archives/mytweet-service-test.zip">here</a>.</p>
<ul>
<li>Save to a temporary folder and import into Eclipse as shown in Figure 1.</li>
</ul>
<p><img src="img/22.png" alt="Figure 1: Import archived project"></p>
<p>Here is the expanded project structure:</p>
<p><img src="img/09.png" alt="Figure 2: Structure of JUnit test app"></p>
<p>Observe the similarity between fields in the models in this test app and the service app (TweetService). </p>
<ul>
<li>Note that initially we will only test against the model class <em>Tweet</em>. Testing the class <em>Tweeter</em>, representing a user, will follow.</li>
</ul>
<pre><code>package app.models;
import java.util.Date;
import java.util.UUID;

import com.google.common.base.Objects;

import static com.google.common.base.MoreObjects.toStringHelper;

public class Tweet
{

  public String id;
  public String message;
  public String datestamp;

  public Tweet(){}

  public Tweet(String message)
  {
    this.id       = UUID.randomUUID().toString();
    this.message    = message;
    this.datestamp  = new Date().toString();
  }

  @Override
  public boolean equals(final Object obj)
  {
    if (obj instanceof Tweet)
    {
      final Tweet other = (Tweet) obj;        
      return     Objects.equal(id,        other.id)
              &amp;&amp; Objects.equal(message,   other.message)
              &amp;&amp; Objects.equal(datestamp, other.datestamp)  ;                          
    }
    else
    {
      return false;
    }
  }  

  @Override
  public String toString()
  {
     return toStringHelper(this)
         .addValue(id)
         .addValue(message)
         .addValue(datestamp)
         .toString();

  }

}</code></pre>
<p>Study the code in the API and Proxy classes:</p>
<pre><code>package app.main;

import java.util.List;

import com.google.gson.Gson;
import com.google.gson.GsonBuilder;
import app.models.Tweet;
import retrofit.Call;
import retrofit.GsonConverterFactory;
import retrofit.Response;
import retrofit.Retrofit;

public class TweetsAPI
{
  private String service_url = &quot;http://localhost:9000&quot;;
  private TweetServiceProxy service;

  public TweetsAPI()
  {
    Gson gson = new GsonBuilder().create();

    Retrofit retrofit = new Retrofit.Builder().baseUrl(service_url)
                             .addConverterFactory(GsonConverterFactory
                             .create(gson))
                             .build();
    service = retrofit.create(TweetServiceProxy.class);
  }

  public Tweet createTweet(String id, Tweet newTweet) throws Exception
  {
    Call&lt;Tweet&gt; call = (Call&lt;Tweet&gt;) service.createTweet(id, newTweet);
    Response&lt;Tweet&gt; returnedTweet = call.execute();
    return returnedTweet.body();
  }

}</code></pre>
<pre><code>
package app.main;

import app.models.Tweet;
import retrofit.Call;
import retrofit.http.Body;
import retrofit.http.POST;

public interface MyTweetServiceProxy
{
  @POST(&quot;/api/tweets&quot;)
  Call&lt;Tweet&gt; createTweet(@Body Tweet tweet);
}</code></pre>
<p>Note the <strong>URL</strong> in the <em>TweetsAPI</em> class:</p>
<pre><code>  private String service_url = &quot;http://localhost:9000&quot;;</code></pre>
<p>This IP address works for the test app but not for the Android app if running within Genymotion or Android emulators. Following is a set of service_urls for various target devices and a typical Heroku deployment:</p>
<pre><code>public String          service_url  = &quot;http://10.0.2.2:9000&quot;;  //Android Emulator
public String          service_url  = &quot;http://10.0.3.2:9000&quot;;  //Genymotion
public String          service_url  = &quot;https://donation-service-2015.herokuapp.com/&quot;;</code></pre>
<p>Run the test and verify it passes. In this <em>walking skeleton</em> we perform only 1 test, namely to create a tweet and check that the tweet echoed back across the network matches the one created.</p>
<p>As you introduce further tests, TweetsAPI and TweetServiceProxy classes will require additional fuctionality.</p>
<p>In this step we have tested the API method <em>createTweet</em>. As part of reproducing this walking skeletion you are recommended to also test:</p>
<ul>
<li>getAllTweeters</li>
<li>createTweeter</li>
</ul>
<p>These three API calls, createTweet, createTweeter and getAllTweeters, are invoked in the Android client part of this lab.</p>
<p>This concludes a walking skeleton of the test and service apps.</p>
<p>Next we shall address the Android client and test it against the same service application developed here.</p>
<p><img src="img/21.png" alt="Figure 3: Test creation of tweet"></p>
<p>The relationships between the Play routes, api and proxy files is illustrated in Figure 4.</p>
<p><img src="img/18.png" alt="Figure 4: Relationship between routes, api and proxy files"></p>

      </div>
     
      <div  class="ui tab segment lab" data-tab="05">
        <h1>Android client</h1>
<p>We now address the refactoring of assignment 1 app into an Android client capable of interacting with the server-side Play app (TweetService).</p>
<p>The steps outline below comprise one of many possible approaches to developing MyTweet native Android client.</p>
<p>The baseline version of MyTweet is shown here:</p>
<p><img src="img/10.png" alt="Figure 1: Baseline MyTweet"></p>
<p>As already pointed out, this is a standalone app and the purpose of this lab is to refactor it so that its data will reside on another app (TweetService) that will be located on a server (localhost or the cloud - Heroku).</p>
<p>The design approach we adopt here will facilate the introduction of a user model and associated views in later versions of the assignment. </p>
<ul>
<li>In particular we will introduce a new activity which we shall name Welcome. </li>
<li>A key reason for this is to provide a convenient location to retrieve the server-side data. It is also a convenient location for the log in and sign up buttons.<ul>
<li>Here we retrieve a list of tweeters (users). This is feasible only in a prototypical case. It would be completely unrealistic to do so in a production environment. <ul>
<li>The <a href="http://www.statista.com/statistics/282087/number-of-monthly-active-twitter-users/">number of monthly active Twitter users</a> worldwide in quarter three 2015 is reported at over 300 million.</li>
</ul>
</li>
<li>We use the tweeter list to determine <ul>
<li>if a tweeter is registered or not as it attempts to log on </li>
<li>and to check if a tweeter attempting to register has already done so.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="img/11.png" alt="Figure 2: Refactored MyTweet activities"></p>

      </div>
     
      <div  class="ui tab segment lab" data-tab="06">
        <h1>Android Client (API)</h1>
<p>Here we present a screenshot of the folder structure used in preparing this lab. It is appreciated that yours will likely vary considerably from this.</p>
<p><img src="img/17.png" alt="Figure 1: MyTweet source code file structure"></p>
<p>Here is the code for the http module classes: Request, Response, Rest followed by the TweetsAPI class.</p>
<p>You may find it necessary to refactor the package name to suit your folder structure.</p>
<p>The service url is located in MyApp. Here is a sample list (already presented):</p>
<pre><code>  public String          service_url  = &quot;http://10.0.2.2:9000&quot;;    //Android Emulator
  public String          service_url  = &quot;http://10.0.3.2:9000&quot;;    //Genymotion
  public String          service_url  = &quot;https://donation-service-2015.herokuapp.com/&quot;;</code></pre>
<p>The Retrofit client is initialized in the MyTweetApp class as shown here:</p>
<pre><code>package org.wit.ictskills.app;


import org.wit.ictskills.main.MyTweetServiceProxy;
import org.wit.ictskills.models.Tweeter;
import java.util.List;
import android.app.Application;

import com.google.gson.Gson;
import com.google.gson.GsonBuilder;
import retrofit.GsonConverterFactory;
import retrofit.Retrofit;

import static org.wit.android.helpers.LogHelpers.info;


public class MyTweetApp extends Application
{
  public String  service_url = &quot;http://10.0.3.2:9000&quot;; //Genymotion

  public MyTweetServiceProxy tweetService;

  public List&lt;Tweeter&gt; tweetersList;
  public Tweeter loggedOnTweeter;

  @Override
  public void onCreate()
  {
    super.onCreate();

    Gson gson = new GsonBuilder().create();
    Retrofit retrofit = new Retrofit.Builder()
        .baseUrl(service_url)
        .addConverterFactory(GsonConverterFactory.create(gson))
        .build();
    tweetService = retrofit.create(MyTweetServiceProxy.class);

    info(this, &quot;MyTweet app launched&quot;);
  }
}</code></pre>
<p>Here is a code snippet from MyTweetServiceProxy containing the API calls used in this lab.</p>
<pre><code>package org.wit.ictskills.main;

import org.wit.ictskills.models.Tweet;
import org.wit.ictskills.models.Tweeter;

import java.util.List;

import retrofit.Call;
import retrofit.Callback;
import retrofit.http.Body;
import retrofit.http.DELETE;
import retrofit.http.GET;
import retrofit.http.POST;
import retrofit.http.Path;

public interface MyTweetServiceProxy
{

  // Create a tweeter
  @POST(&quot;/api/tweeters&quot;)
  Call&lt;Tweeter&gt; createTweeter(@Body Tweeter tweeter);

  // Get all tweets
  @GET(&quot;/api/tweets&quot;)
  Call&lt;List&lt;Tweet&gt;&gt; getAllTweets();

  // Create a tweet
  @POST(&quot;/api/tweeters/{id}/tweets&quot;)
  Call&lt;Tweet&gt; createTweet(@Path(&quot;id&quot;) String id, @Body Tweet tweet);

}</code></pre>

      </div>
     
      <div  class="ui tab segment lab" data-tab="07">
        <h1>Android Client (Create Tweet)</h1>
<p>Here is a quick-start approach to develop the Android client:</p>
<ul>
<li>Refactor the Android MyTweet application that you developed for Assignment 1 to enable it transmit a tweet to the sevice app running on local host:<ul>
<li>Implement Retrofit Callback interface</li>
<li>Implement the Callback methods</li>
<li>Intervene at the point where you created a Tweet and invoke a Retrofit API call to transmit the tweet to the service.</li>
</ul>
</li>
</ul>
<pre><code>// Retrofit Callback interface
public class TweetFragment extends Fragment implements TextWatcher,
                                                       OnClickListener,
                                                       Callback&lt;Tweet&gt;

{
  ...
  ...
}</code></pre>
<pre><code>  // Make the API call once the tweet has been fully formed.
  Call&lt;Tweet&gt; call = app.tweetService.createTweet(tweet.id, tweet);
  call.enqueue(this);</code></pre>
<pre><code>  // Implement the Callback methods
  @Override
  public void onResponse(Response&lt;Tweet&gt; response, Retrofit retrofit)
  {
    Tweet returnedTweet = response.body();
    // If returned tweet matches the tweet we created and transmitted to the server then success.
    if (tweet.equals(returnedTweet))
    {
      Toast.makeText(getActivity(), &quot;Tweet created successfully&quot;, Toast.LENGTH_LONG).show();
    }
    else
    {
      Toast.makeText(getActivity(), &quot;Failed to create tweet&quot;, Toast.LENGTH_LONG).show();
    }
  }

  @Override
  public void onFailure(Throwable t)
  {
    Toast.makeText(getActivity(), &quot;Failed to create tweet due to unknown network issue&quot;, Toast.LENGTH_LONG).show();
  }</code></pre>
<p>Once the above has been completed successfully you could proceed by adding log in and sign up screens.</p>
<p>In the WelcomeActivity class, retrieve the list of tweets from the server , the code for which is provided below.</p>
<ul>
<li>Figure 1 shows a basic Welcome activity screen.</li>
</ul>
<p><img src="img/12.png" alt="Figure 1: Welcome activity"></p>
<p>Note the following:</p>
<ul>
<li>WelcomeActivity implements the <a href="http://square.github.io/retrofit/">Retrofit client</a> <strong>Callback<T></strong> interface.<ul>
<li>This necessitates implementation of its associated methods:<ul>
<li>onResponse</li>
<li>onFailure</li>
</ul>
</li>
</ul>
</li>
<li>The call to the server to retrieve the list of tweeters is made in the <em>onResume</em> method located in the TweetFragment class.<ul>
<li>If the call is successful the list of tweets becomes available in <em>onResponse</em>.<ul>
<li>This allows us to authenticate a new tweeter.</li>
<li>Once the tweeter logs in, a subset if its tweets could then be downloaded. This has not been addressed in this lab. We simply download all tweets.</li>
</ul>
</li>
<li>If the network call fails then an exception is thrown and it&#39;s message is toasted in <em>onFailure</em>.</li>
</ul>
</li>
</ul>
<p>Here is a snippet from WelcomeActivity.java</p>
<pre><code>package org.wit.ictskills.activities;

import android.os.Bundle;
import android.app.Activity;
import android.view.View;
import android.widget.Button;
import android.widget.Toast;

import org.wit.android.helpers.IntentHelper;
import org.wit.ictskills.R;
import org.wit.ictskills.app.MyTweetApp;
import org.wit.ictskills.models.Tweeter;

import java.util.List;

import retrofit.Call;
import retrofit.Callback;
import retrofit.Response;
import retrofit.Retrofit;

public class WelcomeActivity extends Activity implements Callback&lt;List&lt;Tweeter&gt;&gt;
{
  private MyTweetApp app;

  @Override
  protected void onCreate(Bundle savedInstanceState)
  {
    super.onCreate(savedInstanceState);
    setContentView(R.layout.activity_welcome);
    app = (MyTweetApp) getApplication();

  }


  @Override
  public void onResume()
  {
    super.onResume();
    Call&lt;List&lt;Tweeter&gt;&gt; call = app.tweetService.getAllTweeters();
    call.enqueue(this);

  }

  @Override
  public void onResponse(Response&lt;List&lt;Tweeter&gt;&gt; response, Retrofit retrofit)
  {

    app.tweetersList = response.body();
    int numberTweeters = app.tweetersList.size();
    Toast.makeText(this, &quot;Retrieved &quot; + numberTweeters + &quot; tweeters&quot;, Toast.LENGTH_LONG).show();

  }

  @Override
  public void onFailure(Throwable t)
  {
    Toast.makeText(this, &quot;Failed to retrieve tweeter list&quot;, Toast.LENGTH_LONG).show();
  }
}</code></pre>

      </div>
     
      <div  class="ui tab segment lab" data-tab="08">
        <h1>Android Client (Model)</h1>
<p>Here is the code for Tweet.java, the model class.</p>
<ul>
<li>The serialization-related code has been removed in the interest of clarity.</li>
<li>Observe how the field names correspond to those in the server app (TweetService).</li>
<li>Note the difference in the type used for the id field here compared to this week&#39;s Donation labs.</li>
</ul>
<pre><code>package org.wit.mytweet.model;

import java.util.Date;
import java.util.UUID;

public class Tweet
{
  /**
   * The id is required immediately on the client-side
   * We send to id the server in the http call and configure the server to allow this practice
   */
  public   String id;
  public   String message;
  public   String datestamp;


  public Tweet(String message)
  {
    id = UUID.randomUUID().toString();
    datestamp = new Date().toString();
    this.message = message;
  }

}</code></pre>

      </div>
     
      <div  class="ui tab segment lab" data-tab="09">
        <h1>Primary key</h1>
<h2>Generating the Tweet database table <strong>id</strong> in the client</h2>
<p>Default Play framework behaviour is to generate a default Long id primary key.</p>
<p>Let&#39;s explore why this would be problematical for us.</p>
<p>Here is a typical code snippet from a list fragment:</p>
<pre><code>
  @Override
  public boolean onOptionsItemSelected(MenuItem item)
  {
    switch (item.getItemId())
    {
     ...
    case R.id.menuTweet:
      Tweet tweet = new Tweet(); //Item 1
      tweetlist.addTweet(tweet);

      Intent i = new Intent(getActivity(), TweetPagerActivity.class);
      i.putExtra(TweetFragment.EXTRA_TWEET_ID, tweet.id; //Item 2
      startActivityForResult(i, 0);
      return true;

    default:
      return super.onOptionsItemSelected(item);
    }
  }</code></pre>
<p>Item 1: We create a default Tweet object.</p>
<p>Item 2: We put an <em>Extra</em> to the new Intent. This extra has as an argument the value of the Tweet id:</p>
<ul>
<li>tweet.id</li>
</ul>
<p>Were we to adopt the default Play framework approach, then it would be necessary to make an extra network call to obtain the object id.</p>
<p>Our approach requires a simple change to the service model:</p>
<p>Here is the default:</p>
<pre><code>@Entity
public class Tweet extends Model
{
  public Long   id;

}</code></pre>
<p>The non-Play approach is reflected here. There are three changes:</p>
<ul>
<li>The class is now derived from GenericModel.</li>
<li>the @Id annotation is introduced.</li>
<li>The id type is String to accommodate the 128-bit UUID. Long has 64 bits.</li>
</ul>
<pre><code>@Entity
public class Tweet extends GenericModel
{
  @Id
  public String  id;

}</code></pre>

      </div>
     
      <div  class="ui tab segment lab" data-tab="10">
        <h1>Date field</h1>
<p>For the sake of simplicity, all the sample model fields used earlier in this lab are <em>String</em> type.</p>
<p><img src="img/23.png" alt="Figure 1: Model Tweet class"></p>
<p>The choice will prove problematic for those who require to sort tweets with reference to their timestamps.</p>
<p>An obvious choice of type where we require to sort tweets would be java.util.Date.</p>
<p>This, however, poses a problem in testing. For reasons that we have not fully researched, if Date is used as the datestamp type then the JUnit test fails. An examination of underlying date values of the outgoing and returned tweet dates reveal differences. See Figure 2.</p>
<p><img src="img/29.png" alt="Figure 2: Date objects fail test"></p>
<p>A Date object represents the number of milliseconds since January 1 1970. See documentation <a href="https://docs.oracle.com/javase/7/docs/api/java/util/Date.html">here</a>. This number, a long type, is returned by Date.getTime(). </p>
<p>Using the Java type Long avoids the problem described above.</p>
<p>Tweet.datestamp can be declared and initialized thus:</p>
<pre><code>  public Long datestamp;

  public Tweet()
  {
    ...
    this.datestamp = new Date().getTime();
  }</code></pre>
<p>The datestamp is easily formatted so as to comply with one&#39;s display requirements. Here is some sample code that could be used as a template:</p>
<pre><code>  /**
   * Formats the datestamp field by first converting
   * to a Date object and then using the private
   * helper method formattedDate.
   */
  public String getDateString()
  {
    return formattedDate(new Date(datestamp));
  }

  /**
   * @param date A java.util.Date object
   * @see &lt;a href=&quot;http://docs.oracle.com/javase/tutorial/i18n/format/simpleDateFormat.html&quot;&gt;Date Format&lt;/a&gt;
   * @see &lt;a href=&quot;http://docs.oracle.com/javase/7/docs/api/java/text/SimpleDateFormat.html&quot;&gt;Simple Date Format&lt;/a&gt;
   * @return A formatted date string
   */
  private String formattedDate(Date date)
  {
    DateFormat sdf = new SimpleDateFormat(&quot;EEE d MMM yyyy H:mm&quot;);
    sdf.setTimeZone(TimeZone.getTimeZone(&quot;GMT&quot;));
    return sdf.format(datestamp);
  }</code></pre>

      </div>
     
      <div  class="ui tab segment lab" data-tab="11">
        <h1>Resources</h1>
<ul>
<li>A draft development timeline is available <a href="archives/development-timeline.pdf">here</a></li>
</ul>

      </div>
     
    </div>
  </div>
</div>
  <div class="ui bottom fixed borderless right menu">
    <div class="ui right tiny menu">
      <div class="ui mini message segment">
        Eamonn de Leastar (edeleastar@tssg.wit.ie) & John Fitzgerald (johnjfitzgerald@outlook.com).
        <a  href="http://creativecommons.org/licenses/by-nc/4.0/" title="External link to http://creativecommons.org/licenses/by-nc/4.0/"
            target="_blank">Creative Commons License
        </a>
      </div>
    </div>
  </div>

    <footer>

    </footer>
    <script>
      
$(document).ready(function()
{
  $("img").addClass ("ui image");
  $('.ui.embed').embed();

  var images = $(".lab img");
  jQuery.each(images, function(i)  {
    if((images[i].alt).length > 0)
    {
      var div_img = $(document.createElement("div")).addClass("ui segment");
      $(images[i]).wrap(div_img);
      var div_label = $(document.createElement("div")).addClass("ui ribbon teal top attached label");
      div_label.append(images[i].alt);
      $(div_label).insertBefore(images[i]);
    }
  });


  $('.ui.menu .item')
      .tab({
        history: true,
        historyType: 'hash',
      });

  $('.popup').popup();

  $('.ui.sidebar')
      .sidebar({ context: $('.pushable') })
      .sidebar('setting', 'transition', 'slide out')
      .sidebar('attach events', '#toc');
});

    </script>
  </body>

 </html>